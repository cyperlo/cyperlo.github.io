<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Spring å¸¸ç”¨æ‰©å±•ç‚¹</title>
    <link href="/2025/05/09/Java/Spring/Spring%20%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95%E7%82%B9/"/>
    <url>/2025/05/09/Java/Spring/Spring%20%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="Spring-å¸¸ç”¨æ‰©å±•ç‚¹"><a href="#Spring-å¸¸ç”¨æ‰©å±•ç‚¹" class="headerlink" title="Spring å¸¸ç”¨æ‰©å±•ç‚¹"></a>Spring å¸¸ç”¨æ‰©å±•ç‚¹</h1><p>Springçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯å®¹å™¨ï¼Œå½“å®¹å™¨refreshçš„æ—¶å€™ï¼Œå¤–éƒ¨çœ‹ä¸Šå»é£å¹³æµªé™ï¼Œå…¶å®å†…éƒ¨åˆ™æ˜¯ä¸€ç‰‡æƒŠæ¶›éª‡æµªï¼Œæ±ªæ´‹ä¸€ç‰‡ã€‚Springbootæ›´æ˜¯å°è£…äº†Springï¼Œéµå¾ªçº¦å®šå¤§äºé…ç½®ï¼ŒåŠ ä¸Šè‡ªåŠ¨è£…é…çš„æœºåˆ¶ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åªè¦å¼•ç”¨äº†ä¸€ä¸ªä¾èµ–ï¼Œå‡ ä¹æ˜¯é›¶é…ç½®å°±èƒ½å®Œæˆä¸€ä¸ªåŠŸèƒ½çš„è£…é…ã€‚</p><p>è¿™ç¯‡æ–‡ç« æ€»ç»“äº† <code>Spring</code>æ‰€æœ‰çš„æ‰©å±•æ¥å£ï¼Œä»¥åŠå„ä¸ªæ‰©å±•ç‚¹çš„ä½¿ç”¨åœºæ™¯ã€‚å¹¶ä¸”æ•´ç†å‡ºäº†ä¸€ä¸ªbeanåœ¨springå†…éƒ¨ä»è¢«åŠ è½½åˆ°æœ€ååˆå§‹åŒ–å®Œæˆæ‰€æœ‰å¯æ‰©å±•ç‚¹çš„é¡ºåºè°ƒç”¨å›¾ã€‚ä»è€Œæˆ‘ä»¬ä¹Ÿèƒ½çª¥æ¢åˆ°beanæ˜¯å¦‚ä½•ä¸€æ­¥æ­¥åŠ è½½åˆ°springå®¹å™¨ä¸­çš„ã€‚</p><h2 id="1-è°ƒç”¨é¡ºåº"><a href="#1-è°ƒç”¨é¡ºåº" class="headerlink" title="1. è°ƒç”¨é¡ºåº"></a>1. è°ƒç”¨é¡ºåº</h2><p>ä»¥ä¸‹æŒ‰ Spring å®¹å™¨ç”Ÿå‘½å‘¨æœŸé˜¶æ®µåˆ†ç±»æ•´ç†äº†å¸¸è§æ‰©å±•ç‚¹åŠå…¶æ–¹æ³•ï¼Œä¾¿äºç†è§£æ‰§è¡Œæ—¶æœºå’Œä½œç”¨ã€‚</p><h3 id="ğŸŸ¦-1-å®¹å™¨åˆå§‹åŒ–é˜¶æ®µï¼ˆApplicationContext-åˆå§‹åŒ–å‰ï¼‰"><a href="#ğŸŸ¦-1-å®¹å™¨åˆå§‹åŒ–é˜¶æ®µï¼ˆApplicationContext-åˆå§‹åŒ–å‰ï¼‰" class="headerlink" title="ğŸŸ¦ 1. å®¹å™¨åˆå§‹åŒ–é˜¶æ®µï¼ˆApplicationContext åˆå§‹åŒ–å‰ï¼‰"></a>ğŸŸ¦ 1. å®¹å™¨åˆå§‹åŒ–é˜¶æ®µï¼ˆ<code>ApplicationContext</code> åˆå§‹åŒ–å‰ï¼‰</h3><table><thead><tr><th>æ‰©å±•ç‚¹</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ApplicationContextInitializer</code></td><td><code>initialize()</code></td><td>åˆå§‹åŒ– <code>ApplicationContext</code> ä¹‹å‰æ‰§è¡Œï¼Œé€šå¸¸é…åˆ SpringBoot ä½¿ç”¨</td></tr><tr><td><code>AbstractApplicationContext</code></td><td><code>refresh()</code></td><td>å¯åŠ¨å®¹å™¨çš„ä¸»æµç¨‹å…¥å£æ–¹æ³•</td></tr></tbody></table><hr><h3 id="ğŸŸ¦-2-Bean-å®šä¹‰é˜¶æ®µï¼ˆBean-è¿˜æœªå®ä¾‹åŒ–ï¼‰"><a href="#ğŸŸ¦-2-Bean-å®šä¹‰é˜¶æ®µï¼ˆBean-è¿˜æœªå®ä¾‹åŒ–ï¼‰" class="headerlink" title="ğŸŸ¦ 2. Bean å®šä¹‰é˜¶æ®µï¼ˆBean è¿˜æœªå®ä¾‹åŒ–ï¼‰"></a>ğŸŸ¦ 2. Bean å®šä¹‰é˜¶æ®µï¼ˆBean è¿˜æœªå®ä¾‹åŒ–ï¼‰</h3><table><thead><tr><th>æ‰©å±•ç‚¹</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>BeanDefinitionRegistryPostProcessor</code></td><td><code>postProcessBeanDefinitionRegistry()</code></td><td>å¯åŠ¨æ€æ³¨å†Œ&#x2F;ä¿®æ”¹ Bean å®šä¹‰</td></tr><tr><td><code>BeanDefinitionRegistryPostProcessor</code></td><td><code>postProcessBeanFactory()</code></td><td>å¯æ“ä½œ BeanFactory</td></tr><tr><td><code>BeanFactoryPostProcessor</code></td><td><code>postProcessBeanFactory()</code></td><td>å¯ä¿®æ”¹ BeanDefinition çš„å±æ€§</td></tr></tbody></table><hr><h3 id="ğŸŸ§-3-Bean-å®ä¾‹åŒ–å‰é˜¶æ®µï¼ˆå¯¹è±¡è¿˜æ²¡åˆ›å»ºï¼‰"><a href="#ğŸŸ§-3-Bean-å®ä¾‹åŒ–å‰é˜¶æ®µï¼ˆå¯¹è±¡è¿˜æ²¡åˆ›å»ºï¼‰" class="headerlink" title="ğŸŸ§ 3. Bean å®ä¾‹åŒ–å‰é˜¶æ®µï¼ˆå¯¹è±¡è¿˜æ²¡åˆ›å»ºï¼‰"></a>ğŸŸ§ 3. Bean å®ä¾‹åŒ–å‰é˜¶æ®µï¼ˆå¯¹è±¡è¿˜æ²¡åˆ›å»ºï¼‰</h3><table><thead><tr><th>æ‰©å±•ç‚¹</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>InstantiationAwareBeanPostProcessor</code></td><td><code>postProcessBeforeInstantiation()</code></td><td>åˆ›å»ºå®ä¾‹å‰ï¼Œå¯è¿”å›ä»£ç†å¯¹è±¡çŸ­è·¯æµç¨‹</td></tr><tr><td><code>SmartInstantiationAwareBeanPostProcessor</code></td><td><code>determineCandidateConstructors()</code></td><td>å†³å®šä½¿ç”¨å“ªä¸ªæ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹</td></tr></tbody></table><h3 id="ğŸŸ¨-4-Bean-å®ä¾‹åŒ–åé˜¶æ®µï¼ˆå·²åˆ›å»ºä½†æœªå¡«å……å±æ€§ï¼‰"><a href="#ğŸŸ¨-4-Bean-å®ä¾‹åŒ–åé˜¶æ®µï¼ˆå·²åˆ›å»ºä½†æœªå¡«å……å±æ€§ï¼‰" class="headerlink" title="ğŸŸ¨ 4. Bean å®ä¾‹åŒ–åé˜¶æ®µï¼ˆå·²åˆ›å»ºä½†æœªå¡«å……å±æ€§ï¼‰"></a>ğŸŸ¨ 4. Bean å®ä¾‹åŒ–åé˜¶æ®µï¼ˆå·²åˆ›å»ºä½†æœªå¡«å……å±æ€§ï¼‰</h3><table><thead><tr><th>æ‰©å±•ç‚¹</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>MergedBeanDefinitionPostProcessor</code></td><td><code>postProcessMergedBeanDefinition()</code></td><td>å¤„ç†åˆå¹¶åçš„ Bean å®šä¹‰ï¼Œå¸¸ç”¨äºæ³¨è§£æ”¯æŒ</td></tr><tr><td><code>InstantiationAwareBeanPostProcessor</code></td><td><code>postProcessAfterInstantiation()</code></td><td>å®ä¾‹åŒ–åï¼Œå±æ€§æ³¨å…¥å‰</td></tr><tr><td><code>SmartInstantiationAwareBeanPostProcessor</code></td><td><code>getEarlyBeanReference()</code></td><td>æä¾›æ—©æœŸå¼•ç”¨ï¼Œè§£å†³å¾ªç¯ä¾èµ–</td></tr><tr><td><code>BeanFactoryAware</code></td><td><code>setBeanFactory()</code></td><td>æ³¨å…¥ <code>BeanFactory</code> å®ä¾‹</td></tr></tbody></table><hr><h3 id="ğŸŸ©-5-å±æ€§æ³¨å…¥å’Œåˆå§‹åŒ–é˜¶æ®µ"><a href="#ğŸŸ©-5-å±æ€§æ³¨å…¥å’Œåˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="ğŸŸ© 5. å±æ€§æ³¨å…¥å’Œåˆå§‹åŒ–é˜¶æ®µ"></a>ğŸŸ© 5. å±æ€§æ³¨å…¥å’Œåˆå§‹åŒ–é˜¶æ®µ</h3><table><thead><tr><th>æ‰©å±•ç‚¹</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>InstantiationAwareBeanPostProcessor</code></td><td><code>postProcessPropertyValues()</code></td><td>å±æ€§å¡«å……æ—¶è°ƒç”¨</td></tr><tr><td><code>ApplicationContextAwareProcessor</code></td><td><code>invokeAwareInterfaces()</code></td><td>æ³¨å…¥å¦‚ <code>ApplicationContext</code>, <code>BeanName</code> ç­‰ Aware æ¥å£</td></tr><tr><td><code>BeanNameAware</code></td><td><code>setBeanName()</code></td><td>æ³¨å…¥å½“å‰ Bean çš„åç§°</td></tr><tr><td><code>InstantiationAwareBeanPostProcessor</code></td><td><code>postProcessBeforeInitialization()</code></td><td>åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨å‰</td></tr><tr><td><code>@PostConstruct</code></td><td>æ³¨è§£æ–¹æ³•</td><td>åˆå§‹åŒ–æ³¨è§£ï¼ˆJSR-250ï¼‰</td></tr><tr><td><code>InitializingBean</code></td><td><code>afterPropertiesSet()</code></td><td>åˆå§‹åŒ–å›è°ƒ</td></tr><tr><td><code>InstantiationAwareBeanPostProcessor</code></td><td><code>postProcessAfterInitialization()</code></td><td>åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨åï¼Œå¸¸ç”¨äºç”Ÿæˆä»£ç†</td></tr></tbody></table><hr><h3 id="ğŸŸ¦-6-ç‰¹æ®Š-Bean-å¤„ç†é˜¶æ®µ"><a href="#ğŸŸ¦-6-ç‰¹æ®Š-Bean-å¤„ç†é˜¶æ®µ" class="headerlink" title="ğŸŸ¦ 6. ç‰¹æ®Š Bean å¤„ç†é˜¶æ®µ"></a>ğŸŸ¦ 6. ç‰¹æ®Š Bean å¤„ç†é˜¶æ®µ</h3><table><thead><tr><th>æ‰©å±•ç‚¹</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>FactoryBean</code></td><td><code>getObject()</code></td><td>æä¾›ç‰¹æ®Š Bean çš„å·¥å‚æ¥å£</td></tr><tr><td><code>SmartInitializingSingleton</code></td><td><code>afterSingletonsInstantiated()</code></td><td>æ‰€æœ‰å•ä¾‹å¯¹è±¡åˆå§‹åŒ–å®Œæ¯•åæ‰§è¡Œ</td></tr></tbody></table><hr><h3 id="ğŸŸ¥-7-åº”ç”¨è¿è¡Œä¸é”€æ¯é˜¶æ®µ"><a href="#ğŸŸ¥-7-åº”ç”¨è¿è¡Œä¸é”€æ¯é˜¶æ®µ" class="headerlink" title="ğŸŸ¥ 7. åº”ç”¨è¿è¡Œä¸é”€æ¯é˜¶æ®µ"></a>ğŸŸ¥ 7. åº”ç”¨è¿è¡Œä¸é”€æ¯é˜¶æ®µ</h3><table><thead><tr><th>æ‰©å±•ç‚¹</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>CommandLineRunner</code></td><td><code>run()</code></td><td>SpringBoot å¯åŠ¨åç«‹å³æ‰§è¡Œé€»è¾‘</td></tr><tr><td><code>DisposableBean</code></td><td><code>destroy()</code></td><td>Bean é”€æ¯å›è°ƒæ–¹æ³•ï¼Œå®¹å™¨å…³é—­æ—¶è§¦å‘</td></tr></tbody></table><h2 id="2-å¸¸ç”¨æ‰©å±•ç‚¹ç¤ºä¾‹"><a href="#2-å¸¸ç”¨æ‰©å±•ç‚¹ç¤ºä¾‹" class="headerlink" title="2. å¸¸ç”¨æ‰©å±•ç‚¹ç¤ºä¾‹"></a>2. å¸¸ç”¨æ‰©å±•ç‚¹ç¤ºä¾‹</h2><h3 id="1-ApplicationContextInitializer"><a href="#1-ApplicationContextInitializer" class="headerlink" title="1. ApplicationContextInitializer"></a>1. ApplicationContextInitializer</h3><blockquote><p>org.springframework.context.ApplicationContextInitializer</p></blockquote><p>è¿™æ˜¯æ•´ä¸ªspringå®¹å™¨åœ¨åˆ·æ–°ä¹‹å‰åˆå§‹åŒ–ConfigurableApplicationContextçš„å›è°ƒæ¥å£ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨å®¹å™¨åˆ·æ–°ä¹‹å‰è°ƒç”¨æ­¤ç±»çš„initializeæ–¹æ³•ã€‚è¿™ä¸ªç‚¹å…è®¸è¢«ç”¨æˆ·è‡ªå·±æ‰©å±•ã€‚ç”¨æˆ·å¯ä»¥åœ¨æ•´ä¸ªspringå®¹å™¨è¿˜æ²¡è¢«åˆå§‹åŒ–ä¹‹å‰åšä¸€äº›äº‹æƒ…ã€‚<br>å¯ä»¥æƒ³åˆ°çš„åœºæ™¯å¯èƒ½ä¸ºï¼Œåœ¨æœ€å¼€å§‹æ¿€æ´»ä¸€äº›é…ç½®ï¼Œæˆ–è€…åˆ©ç”¨è¿™æ—¶å€™classè¿˜æ²¡è¢«ç±»åŠ è½½å™¨åŠ è½½çš„æ—¶æœºï¼Œè¿›è¡ŒåŠ¨æ€å­—èŠ‚ç æ³¨å…¥ç­‰æ“ä½œã€‚</p><p><strong>æ‰©å±•æ–¹å¼ä¸ºï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestApplicationContextInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextInitializer</span> &#123;    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">(ConfigurableApplicationContext applicationContext)</span> &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[ApplicationContextInitializer]&quot;</span>);    <br>    &#125;    <br>&#125; <br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ¥å£å¯ä»¥åœ¨ Spring Boot ç­‰åŸºäº Spring æ¡†æ¶çš„åº”ç”¨ä¸­ä½¿ç”¨ï¼Œç”¨äºåœ¨åº”ç”¨å¯åŠ¨æ—¶è¿›è¡Œä¸€äº›é…ç½®æˆ–åˆå§‹åŒ–æ“ä½œï¼Œä¾‹å¦‚åŠ è½½é…ç½®æ–‡ä»¶ã€è®¾ç½®ç³»ç»Ÿå±æ€§ã€æ³¨å†Œè‡ªå®šä¹‰çš„ Bean ç­‰ã€‚</p><h3 id="2-BeanDefinitionRegistryPostProcessor"><a href="#2-BeanDefinitionRegistryPostProcessor" class="headerlink" title="2. BeanDefinitionRegistryPostProcessor"></a>2. BeanDefinitionRegistryPostProcessor</h3><blockquote><p>org.springframework.context.ApplicationContextInitializer</p></blockquote><p>è¿™æ˜¯æ•´ä¸ªspringå®¹å™¨åœ¨åˆ·æ–°ä¹‹å‰åˆå§‹åŒ–ConfigurableApplicationContextçš„å›è°ƒæ¥å£ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨å®¹å™¨åˆ·æ–°ä¹‹å‰è°ƒç”¨æ­¤ç±»çš„initializeæ–¹æ³•ã€‚è¿™ä¸ªç‚¹å…è®¸è¢«ç”¨æˆ·è‡ªå·±æ‰©å±•ã€‚ç”¨æˆ·å¯ä»¥åœ¨æ•´ä¸ªspringå®¹å™¨è¿˜æ²¡è¢«åˆå§‹åŒ–ä¹‹å‰åšä¸€äº›äº‹æƒ…ã€‚<br>å¯ä»¥æƒ³åˆ°çš„åœºæ™¯å¯èƒ½ä¸ºï¼Œåœ¨æœ€å¼€å§‹æ¿€æ´»ä¸€äº›é…ç½®ï¼Œæˆ–è€…åˆ©ç”¨è¿™æ—¶å€™classè¿˜æ²¡è¢«ç±»åŠ è½½å™¨åŠ è½½çš„æ—¶æœºï¼Œè¿›è¡ŒåŠ¨æ€å­—èŠ‚ç æ³¨å…¥ç­‰æ“ä½œã€‚</p><p>è¿™ä¸ªæ¥å£å¯ä»¥åœ¨ Spring Boot ç­‰åŸºäº Spring æ¡†æ¶çš„åº”ç”¨ä¸­ä½¿ç”¨ï¼Œç”¨äºåœ¨åº”ç”¨å¯åŠ¨æ—¶è¿›è¡Œä¸€äº›é…ç½®æˆ–åˆå§‹åŒ–æ“ä½œï¼Œä¾‹å¦‚åŠ è½½é…ç½®æ–‡ä»¶ã€è®¾ç½®ç³»ç»Ÿå±æ€§ã€æ³¨å†Œè‡ªå®šä¹‰çš„ Bean ç­‰ã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestApplicationContextInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextInitializer</span> &#123;    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">(ConfigurableApplicationContext applicationContext)</span> &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[ApplicationContextInitializer]&quot;</span>);    <br>    &#125;    <br>&#125;    <br></code></pre></td></tr></table></figure><p>å› ä¸ºè¿™æ—¶å€™springå®¹å™¨è¿˜æ²¡è¢«åˆå§‹åŒ–ï¼Œæ‰€ä»¥æƒ³è¦è‡ªå·±çš„æ‰©å±•çš„ç”Ÿæ•ˆï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>åœ¨å¯åŠ¨ç±»ä¸­ç”¨springApplication.addInitializers(new TestApplicationContextInitializer())è¯­å¥åŠ å…¥</li><li>é…ç½®æ–‡ä»¶é…ç½®context.initializer.classes&#x3D;com.example.demo.TestApplicationContextInitializer</li><li>Spring SPIæ‰©å±•ï¼Œåœ¨spring.factoriesä¸­åŠ å…¥org.springframework.context.ApplicationContextInitializer&#x3D;com.example.demo.TestApplicationContextInitializer</li></ul><h3 id="3-BeanDefinitionRegistryPostProcessor"><a href="#3-BeanDefinitionRegistryPostProcessor" class="headerlink" title="3. BeanDefinitionRegistryPostProcessor"></a>3. BeanDefinitionRegistryPostProcessor</h3><blockquote><p>org.springframework.beans.factory.support.BeanDefinitionRegistryPostProcessor</p></blockquote><p>è¿™ä¸ªæ¥å£åœ¨è¯»å–é¡¹ç›®ä¸­çš„beanDefinitionä¹‹åæ‰§è¡Œï¼Œæä¾›ä¸€ä¸ªè¡¥å……çš„æ‰©å±•ç‚¹</p><p>ä½¿ç”¨åœºæ™¯ï¼šä½ å¯ä»¥åœ¨è¿™é‡ŒåŠ¨æ€æ³¨å†Œè‡ªå·±çš„beanDefinitionï¼Œå¯ä»¥åŠ è½½classpathä¹‹å¤–çš„bean</p><p>æ‰©å±•æ–¹å¼ä¸º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestBeanDefinitionRegistryPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span> &#123;    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[BeanDefinitionRegistryPostProcessor] postProcessBeanDefinitionRegistry&quot;</span>);    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[BeanDefinitionRegistryPostProcessor] postProcessBeanFactory&quot;</span>);    <br>    &#125;    <br>&#125;  <br></code></pre></td></tr></table></figure><h3 id="4-BeanFactoryPostProcessor"><a href="#4-BeanFactoryPostProcessor" class="headerlink" title="4. BeanFactoryPostProcessor"></a>4. BeanFactoryPostProcessor</h3><blockquote><p>org.springframework.beans.factory.config.BeanFactoryPostProcessor</p></blockquote><p>è¿™ä¸ªæ¥å£æ˜¯beanFactoryçš„æ‰©å±•æ¥å£ï¼Œè°ƒç”¨æ—¶æœºåœ¨springåœ¨è¯»å–beanDefinitionä¿¡æ¯ä¹‹åï¼Œå®ä¾‹åŒ–beanä¹‹å‰ã€‚</p><p>åœ¨è¿™ä¸ªæ—¶æœºï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ç°è¿™ä¸ªæ‰©å±•æ¥å£æ¥è‡ªè¡Œå¤„ç†ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚ä¿®æ”¹å·²ç»æ³¨å†Œçš„beanDefinitionçš„å…ƒä¿¡æ¯ã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestBeanFactoryPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span> &#123;    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[BeanFactoryPostProcessor]&quot;</span>);    <br>    &#125;    <br>&#125;    <br></code></pre></td></tr></table></figure><h3 id="5-InstantiationAwareBeanPostProcessor"><a href="#5-InstantiationAwareBeanPostProcessor" class="headerlink" title="5. InstantiationAwareBeanPostProcessor"></a>5. InstantiationAwareBeanPostProcessor</h3><blockquote><p>org.springframework.beans.factory.config.InstantiationAwareBeanPostProcessor</p></blockquote><p>è¯¥æ¥å£ç»§æ‰¿äº†BeanPostProcessæ¥å£ï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š</p><p>BeanPostProcessæ¥å£åªåœ¨beançš„åˆå§‹åŒ–é˜¶æ®µè¿›è¡Œæ‰©å±•ï¼ˆæ³¨å…¥springä¸Šä¸‹æ–‡å‰åï¼‰ï¼Œè€ŒInstantiationAwareBeanPostProcessoræ¥å£åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ äº†3ä¸ªæ–¹æ³•ï¼ŒæŠŠå¯æ‰©å±•çš„èŒƒå›´å¢åŠ äº†å®ä¾‹åŒ–é˜¶æ®µå’Œå±æ€§æ³¨å…¥é˜¶æ®µã€‚</p><p>è¯¥ç±»ä¸»è¦çš„æ‰©å±•ç‚¹æœ‰ä»¥ä¸‹5ä¸ªæ–¹æ³•ï¼Œä¸»è¦åœ¨beanç”Ÿå‘½å‘¨æœŸçš„ä¸¤å¤§é˜¶æ®µï¼šå®ä¾‹åŒ–é˜¶æ®µå’Œåˆå§‹åŒ–é˜¶æ®µï¼Œä¸‹é¢ä¸€èµ·è¿›è¡Œè¯´æ˜ï¼ŒæŒ‰è°ƒç”¨é¡ºåºä¸ºï¼š</p><ul><li>postProcessBeforeInstantiationï¼šå®ä¾‹åŒ–beanä¹‹å‰ï¼Œç›¸å½“äºnewè¿™ä¸ªbeanä¹‹å‰</li><li>postProcessAfterInstantiationï¼šå®ä¾‹åŒ–beanä¹‹åï¼Œç›¸å½“äºnewè¿™ä¸ªbeanä¹‹å</li><li>postProcessPropertyValuesï¼šbeanå·²ç»å®ä¾‹åŒ–å®Œæˆï¼Œåœ¨å±æ€§æ³¨å…¥æ—¶é˜¶æ®µè§¦å‘ï¼Œ@Autowired,@Resourceç­‰æ³¨è§£åŸç†åŸºäºæ­¤æ–¹æ³•å®ç°</li><li>postProcessBeforeInitializationï¼šåˆå§‹åŒ–beanä¹‹å‰ï¼Œç›¸å½“äºæŠŠbeanæ³¨å…¥springä¸Šä¸‹æ–‡ä¹‹å‰</li><li>postProcessAfterInitializationï¼šåˆå§‹åŒ–beanä¹‹åï¼Œç›¸å½“äºæŠŠbeanæ³¨å…¥springä¸Šä¸‹æ–‡ä¹‹å</li></ul><p>ä½¿ç”¨åœºæ™¯ï¼šè¿™ä¸ªæ‰©å±•ç‚¹éå¸¸æœ‰ç”¨ ï¼Œæ— è®ºæ˜¯å†™ä¸­é—´ä»¶å’Œä¸šåŠ¡ä¸­ï¼Œéƒ½èƒ½åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ã€‚æ¯”å¦‚å¯¹å®ç°äº†æŸä¸€ç±»æ¥å£çš„beanåœ¨å„ä¸ªç”Ÿå‘½æœŸé—´è¿›è¡Œæ”¶é›†ï¼Œæˆ–è€…å¯¹æŸä¸ªç±»å‹çš„beanè¿›è¡Œç»Ÿä¸€çš„è®¾å€¼ç­‰ç­‰ã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestInstantiationAwareBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InstantiationAwareBeanPostProcessor</span> &#123;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestInstantiationAwareBeanPostProcessor] before initialization &quot;</span> + beanName);    <br>        <span class="hljs-keyword">return</span> bean;    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestInstantiationAwareBeanPostProcessor] after initialization &quot;</span> + beanName);    <br>        <span class="hljs-keyword">return</span> bean;    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInstantiation</span><span class="hljs-params">(Class&lt;?&gt; beanClass, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestInstantiationAwareBeanPostProcessor] before instantiation &quot;</span> + beanName);    <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">postProcessAfterInstantiation</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestInstantiationAwareBeanPostProcessor] after instantiation &quot;</span> + beanName);    <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> PropertyValues <span class="hljs-title function_">postProcessPropertyValues</span><span class="hljs-params">(PropertyValues pvs, PropertyDescriptor[] pds, Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestInstantiationAwareBeanPostProcessor] postProcessPropertyValues &quot;</span> + beanName);    <br>        <span class="hljs-keyword">return</span> pvs;    <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-SmartInstantiationAwareBeanPostProcessor"><a href="#6-SmartInstantiationAwareBeanPostProcessor" class="headerlink" title="6. SmartInstantiationAwareBeanPostProcessor"></a>6. SmartInstantiationAwareBeanPostProcessor</h3><blockquote><p>org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor</p></blockquote><p>è¯¥æ‰©å±•æ¥å£æœ‰3ä¸ªè§¦å‘ç‚¹æ–¹æ³•ï¼š</p><ul><li>predictBeanTypeï¼šè¯¥è§¦å‘ç‚¹å‘ç”Ÿåœ¨postProcessBeforeInstantiationä¹‹å‰(åœ¨å›¾ä¸Šå¹¶æ²¡æœ‰æ ‡æ˜ï¼Œå› ä¸ºä¸€èˆ¬ä¸å¤ªéœ€è¦æ‰©å±•è¿™ä¸ªç‚¹)ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºé¢„æµ‹Beançš„ç±»å‹ï¼Œè¿”å›ç¬¬ä¸€ä¸ªé¢„æµ‹æˆåŠŸçš„Classç±»å‹ï¼Œå¦‚æœä¸èƒ½é¢„æµ‹è¿”å›nullï¼›å½“ä½ è°ƒç”¨BeanFactory.getType(name)æ—¶å½“é€šè¿‡beançš„åå­—æ— æ³•å¾—åˆ°beanç±»å‹ä¿¡æ¯æ—¶å°±è°ƒç”¨è¯¥å›è°ƒæ–¹æ³•æ¥å†³å®šç±»å‹ä¿¡æ¯ã€‚</li><li>determineCandidateConstructorsï¼šè¯¥è§¦å‘ç‚¹å‘ç”Ÿåœ¨postProcessBeforeInstantiationä¹‹åï¼Œç”¨äºç¡®å®šè¯¥beançš„æ„é€ å‡½æ•°ä¹‹ç”¨ï¼Œè¿”å›çš„æ˜¯è¯¥beançš„æ‰€æœ‰æ„é€ å‡½æ•°åˆ—è¡¨ã€‚ç”¨æˆ·å¯ä»¥æ‰©å±•è¿™ä¸ªç‚¹ï¼Œæ¥è‡ªå®šä¹‰é€‰æ‹©ç›¸åº”çš„æ„é€ å™¨æ¥å®ä¾‹åŒ–è¿™ä¸ªbeanã€‚</li><li>getEarlyBeanReferenceï¼šè¯¥è§¦å‘ç‚¹å‘ç”Ÿåœ¨postProcessAfterInstantiationä¹‹åï¼Œå½“æœ‰å¾ªç¯ä¾èµ–çš„åœºæ™¯ï¼Œå½“beanå®ä¾‹åŒ–å¥½ä¹‹åï¼Œä¸ºäº†é˜²æ­¢æœ‰å¾ªç¯ä¾èµ–ï¼Œä¼šæå‰æš´éœ²å›è°ƒæ–¹æ³•ï¼Œç”¨äºbeanå®ä¾‹åŒ–çš„åç½®å¤„ç†ã€‚è¿™ä¸ªæ–¹æ³•å°±æ˜¯åœ¨æå‰æš´éœ²çš„å›è°ƒæ–¹æ³•ä¸­è§¦å‘ã€‚</li></ul><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSmartInstantiationAwareBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SmartInstantiationAwareBeanPostProcessor</span> &#123;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; predictBeanType(Class&lt;?&gt; beanClass, String beanName) <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestSmartInstantiationAwareBeanPostProcessor] predictBeanType &quot;</span> + beanName);    <br>        <span class="hljs-keyword">return</span> beanClass;    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> Constructor&lt;?&gt;[] determineCandidateConstructors(Class&lt;?&gt; beanClass, String beanName) <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestSmartInstantiationAwareBeanPostProcessor] determineCandidateConstructors &quot;</span> + beanName);    <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getEarlyBeanReference</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestSmartInstantiationAwareBeanPostProcessor] getEarlyBeanReference &quot;</span> + beanName);    <br>        <span class="hljs-keyword">return</span> bean;    <br>    &#125;    <br>&#125;    <br></code></pre></td></tr></table></figure><h3 id="7-BeanFactoryAware"><a href="#7-BeanFactoryAware" class="headerlink" title="7. BeanFactoryAware"></a>7. BeanFactoryAware</h3><blockquote><p>org.springframework.beans.factory.BeanFactoryAware</p></blockquote><p>è¿™ä¸ªç±»åªæœ‰ä¸€ä¸ªè§¦å‘ç‚¹ï¼Œå‘ç”Ÿåœ¨beançš„å®ä¾‹åŒ–ä¹‹åï¼Œæ³¨å…¥å±æ€§ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯Setterä¹‹å‰ã€‚è¿™ä¸ªç±»çš„æ‰©å±•ç‚¹æ–¹æ³•ä¸ºsetBeanFactoryï¼Œå¯ä»¥æ‹¿åˆ°BeanFactoryè¿™ä¸ªå±æ€§ã€‚</p><p>ä½¿ç”¨åœºæ™¯ä¸ºï¼Œä½ å¯ä»¥åœ¨beanå®ä¾‹åŒ–ä¹‹åï¼Œä½†è¿˜æœªåˆå§‹åŒ–ä¹‹å‰ï¼Œæ‹¿åˆ° BeanFactoryï¼Œåœ¨è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥å¯¹æ¯ä¸ªbeanä½œç‰¹æ®ŠåŒ–çš„å®šåˆ¶ã€‚ä¹Ÿæˆ–è€…å¯ä»¥æŠŠBeanFactoryæ‹¿åˆ°è¿›è¡Œç¼“å­˜ï¼Œæ—¥åä½¿ç”¨ã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestBeanFactoryAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span> &#123;    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeanFactory</span><span class="hljs-params">(BeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestBeanFactoryAware] &quot;</span> + beanFactory.getBean(TestBeanFactoryAware.class).getClass().getSimpleName());    <br>    &#125;    <br>&#125;   <br></code></pre></td></tr></table></figure><h3 id="8-ApplicationContextAwareProcessor"><a href="#8-ApplicationContextAwareProcessor" class="headerlink" title="8. ApplicationContextAwareProcessor"></a>8. ApplicationContextAwareProcessor</h3><blockquote><p>org.springframework.context.support.ApplicationContextAwareProcessor</p></blockquote><p>è¯¥ç±»æœ¬èº«å¹¶æ²¡æœ‰æ‰©å±•ç‚¹ï¼Œä½†æ˜¯è¯¥ç±»å†…éƒ¨å´æœ‰6ä¸ªæ‰©å±•ç‚¹å¯ä¾›å®ç° ï¼Œè¿™äº›ç±»è§¦å‘çš„æ—¶æœºåœ¨beanå®ä¾‹åŒ–ä¹‹åï¼Œåˆå§‹åŒ–ä¹‹å‰</p><p>å›¾ç‰‡<br>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç±»ç”¨äºæ‰§è¡Œå„ç§é©±åŠ¨æ¥å£ï¼Œåœ¨beanå®ä¾‹åŒ–ä¹‹åï¼Œå±æ€§å¡«å……ä¹‹åï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸Šçº¢æ¡†æ ‡å‡ºçš„æ‰©å±•æ¥å£ï¼Œæ¥è·å–å¯¹åº”å®¹å™¨çš„å˜é‡ã€‚æ‰€ä»¥è¿™é‡Œåº”è¯¥æ¥è¯´æ˜¯æœ‰6ä¸ªæ‰©å±•ç‚¹ï¼Œè¿™é‡Œå°±æ”¾ä¸€èµ·æ¥è¯´äº†</p><ul><li>EnvironmentAwareï¼šç”¨äºè·å–EnviromentAwareçš„ä¸€ä¸ªæ‰©å±•ç±»ï¼Œè¿™ä¸ªå˜é‡éå¸¸æœ‰ç”¨ï¼Œ å¯ä»¥è·å¾—ç³»ç»Ÿå†…çš„æ‰€æœ‰å‚æ•°ã€‚å½“ç„¶ä¸ªäººè®¤ä¸ºè¿™ä¸ªAwareæ²¡å¿…è¦å»æ‰©å±•ï¼Œå› ä¸ºspringå†…éƒ¨éƒ½å¯ä»¥é€šè¿‡æ³¨å…¥çš„æ–¹å¼æ¥ç›´æ¥è·å¾—ã€‚</li><li>EmbeddedValueResolverAwareï¼šç”¨äºè·å–StringValueResolverçš„ä¸€ä¸ªæ‰©å±•ç±»ï¼Œ StringValueResolverç”¨äºè·å–åŸºäºStringç±»å‹çš„propertiesçš„å˜é‡ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ç”¨@Valueçš„æ–¹å¼å»è·å–ï¼Œå¦‚æœå®ç°äº†è¿™ä¸ªAwareæ¥å£ï¼ŒæŠŠStringValueResolverç¼“å­˜èµ·æ¥ï¼Œé€šè¿‡è¿™ä¸ªç±»å»è·å–Stringç±»å‹çš„å˜é‡ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</li><li>ResourceLoaderAwareï¼šç”¨äºè·å–ResourceLoaderçš„ä¸€ä¸ªæ‰©å±•ç±»ï¼ŒResourceLoaderå¯ä»¥ç”¨äºè·å–classpathå†…æ‰€æœ‰çš„èµ„æºå¯¹è±¡ï¼Œå¯ä»¥æ‰©å±•æ­¤ç±»æ¥æ‹¿åˆ°ResourceLoaderå¯¹è±¡ã€‚</li><li>ApplicationEventPublisherAwareï¼šç”¨äºè·å–ApplicationEventPublisherçš„ä¸€ä¸ªæ‰©å±•ç±»ï¼ŒApplicationEventPublisherå¯ä»¥ç”¨æ¥å‘å¸ƒäº‹ä»¶ï¼Œç»“åˆApplicationListeneræ¥å…±åŒä½¿ç”¨ï¼Œä¸‹æ–‡åœ¨ä»‹ç»ApplicationListeneræ—¶ä¼šè¯¦ç»†æåˆ°ã€‚è¿™ä¸ªå¯¹è±¡ä¹Ÿå¯ä»¥é€šè¿‡springæ³¨å…¥çš„æ–¹å¼æ¥è·å¾—ã€‚</li></ul><p>MessageSourceAwareï¼šç”¨äºè·å–MessageSourceçš„ä¸€ä¸ªæ‰©å±•ç±»ï¼ŒMessageSourceä¸»è¦ç”¨æ¥åšå›½é™…åŒ–ã€‚</p><p>ApplicationContextAwareï¼šç”¨æ¥è·å–ApplicationContextçš„ä¸€ä¸ªæ‰©å±•ç±»ï¼ŒApplicationContextåº”è¯¥æ˜¯å¾ˆå¤šäººéå¸¸ç†Ÿæ‚‰çš„ä¸€ä¸ªç±»äº†ï¼Œå°±æ˜¯springä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå¯ä»¥æ‰‹åŠ¨çš„è·å–ä»»ä½•åœ¨springä¸Šä¸‹æ–‡æ³¨å†Œçš„beanï¼Œæˆ‘ä»¬ç»å¸¸æ‰©å±•è¿™ä¸ªæ¥å£æ¥ç¼“å­˜springä¸Šä¸‹æ–‡ï¼ŒåŒ…è£…æˆé™æ€æ–¹æ³•ã€‚åŒæ—¶ApplicationContextä¹Ÿå®ç°äº†BeanFactoryï¼ŒMessageSourceï¼ŒApplicationEventPublisherç­‰æ¥å£ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åšç›¸å…³æ¥å£çš„äº‹æƒ…ã€‚</p><h3 id="9-BeanNameAware"><a href="#9-BeanNameAware" class="headerlink" title="9. BeanNameAware"></a>9. BeanNameAware</h3><blockquote><p>org.springframework.beans.factory.BeanNameAware</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç±»ä¹Ÿæ˜¯Awareæ‰©å±•çš„ä¸€ç§ï¼Œè§¦å‘ç‚¹åœ¨beançš„åˆå§‹åŒ–ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯postProcessBeforeInitializationä¹‹å‰ï¼Œè¿™ä¸ªç±»çš„è§¦å‘ç‚¹æ–¹æ³•åªæœ‰ä¸€ä¸ªï¼šsetBeanName</p><p>ä½¿ç”¨åœºæ™¯ä¸ºï¼šç”¨æˆ·å¯ä»¥æ‰©å±•è¿™ä¸ªç‚¹ï¼Œåœ¨åˆå§‹åŒ–beanä¹‹å‰æ‹¿åˆ°springå®¹å™¨ä¸­æ³¨å†Œçš„çš„beanNameï¼Œæ¥è‡ªè¡Œä¿®æ”¹è¿™ä¸ªbeanNameçš„å€¼ã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NormalBeanA</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanNameAware</span>&#123;    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">NormalBeanA</span><span class="hljs-params">()</span> &#123;    <br>        System.out.println(<span class="hljs-string">&quot;NormalBean constructor&quot;</span>);    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeanName</span><span class="hljs-params">(String name)</span> &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[BeanNameAware] &quot;</span> + name);    <br>    &#125;    <br>&#125;   <br></code></pre></td></tr></table></figure><h3 id="10-PostConstruct"><a href="#10-PostConstruct" class="headerlink" title="10. @PostConstruct"></a>10. @PostConstruct</h3><blockquote><p>javax.annotation.PostConstruct</p></blockquote><p>è¿™ä¸ªå¹¶ä¸ç®—ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ ‡æ³¨ã€‚å…¶ä½œç”¨æ˜¯åœ¨beançš„åˆå§‹åŒ–é˜¶æ®µï¼Œå¦‚æœå¯¹ä¸€ä¸ªæ–¹æ³•æ ‡æ³¨äº†@PostConstructï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™é‡Œé‡ç‚¹æ˜¯è¦å…³æ³¨ä¸‹è¿™ä¸ªæ ‡å‡†çš„è§¦å‘ç‚¹ï¼Œè¿™ä¸ªè§¦å‘ç‚¹æ˜¯åœ¨postProcessBeforeInitializationä¹‹åï¼ŒInitializingBean.afterPropertiesSetä¹‹å‰ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·å¯ä»¥å¯¹æŸä¸€æ–¹æ³•è¿›è¡Œæ ‡æ³¨ï¼Œæ¥è¿›è¡Œåˆå§‹åŒ–æŸä¸€ä¸ªå±æ€§</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NormalBeanA</span> &#123;    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">NormalBeanA</span><span class="hljs-params">()</span> &#123;    <br>        System.out.println(<span class="hljs-string">&quot;NormalBean constructor&quot;</span>);    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@PostConstruct</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;    <br>        System.out.println(<span class="hljs-string">&quot;[PostConstruct] NormalBeanA&quot;</span>);    <br>    &#125;    <br>&#125;    <br></code></pre></td></tr></table></figure><h3 id="11-InitializingBean"><a href="#11-InitializingBean" class="headerlink" title="11. InitializingBean"></a>11. InitializingBean</h3><blockquote><p>org.springframework.beans.factory.InitializingBean</p></blockquote><p>è¿™ä¸ªç±»ï¼Œé¡¾åæ€ä¹‰ï¼Œä¹Ÿæ˜¯ç”¨æ¥åˆå§‹åŒ–beançš„ã€‚InitializingBeanæ¥å£ä¸ºbeanæä¾›äº†åˆå§‹åŒ–æ–¹æ³•çš„æ–¹å¼ï¼Œå®ƒåªåŒ…æ‹¬afterPropertiesSetæ–¹æ³•ï¼Œå‡¡æ˜¯ç»§æ‰¿è¯¥æ¥å£çš„ç±»ï¼Œåœ¨åˆå§‹åŒ–beançš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œè¯¥æ–¹æ³•ã€‚è¿™ä¸ªæ‰©å±•ç‚¹çš„è§¦å‘æ—¶æœºåœ¨postProcessAfterInitializationä¹‹å‰ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·å®ç°æ­¤æ¥å£ï¼Œæ¥è¿›è¡Œç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ä¸€äº›ä¸šåŠ¡æŒ‡æ ‡çš„åˆå§‹åŒ–å·¥ä½œã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NormalBeanA</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InitializingBean</span>&#123;    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[InitializingBean] NormalBeanA&quot;</span>);    <br>    &#125;    <br>&#125; <br></code></pre></td></tr></table></figure><h3 id="12-FactoryBean"><a href="#12-FactoryBean" class="headerlink" title="12. FactoryBean"></a>12. FactoryBean</h3><blockquote><p>org.springframework.beans.factory.FactoryBean</p></blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSpringé€šè¿‡åå°„æœºåˆ¶åˆ©ç”¨beançš„classå±æ€§æŒ‡å®šæ”¯çº¿ç±»å»å®ä¾‹åŒ–beanï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ä¾‹åŒ–Beanè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœæŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ï¼Œåˆ™éœ€è¦åœ¨beanä¸­æä¾›å¤§é‡çš„é…ç½®ä¿¡æ¯ã€‚é…ç½®æ–¹å¼çš„çµæ´»æ€§æ˜¯å—é™çš„ï¼Œè¿™æ—¶é‡‡ç”¨ç¼–ç çš„æ–¹å¼å¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆã€‚Springä¸ºæ­¤æä¾›äº†ä¸€ä¸ªorg.springframework.bean.factory.FactoryBeançš„å·¥å‚ç±»æ¥å£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ç°è¯¥æ¥å£å®šåˆ¶å®ä¾‹åŒ–Beançš„é€»è¾‘ã€‚</p><p>FactoryBeanæ¥å£å¯¹äºSpringæ¡†æ¶æ¥è¯´å ç”¨é‡è¦çš„åœ°ä½ï¼ŒSpringè‡ªèº«å°±æä¾›äº†70å¤šä¸ªFactoryBeançš„å®ç°ã€‚å®ƒä»¬éšè—äº†å®ä¾‹åŒ–ä¸€äº›å¤æ‚beançš„ç»†èŠ‚ï¼Œç»™ä¸Šå±‚åº”ç”¨å¸¦æ¥äº†ä¾¿åˆ©ã€‚ä»Spring3.0å¼€å§‹ï¼ŒFactoryBeanå¼€å§‹æ”¯æŒæ³›å‹ï¼Œå³æ¥å£å£°æ˜æ”¹ä¸ºFactoryBeançš„å½¢å¼</p><p>ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·å¯ä»¥æ‰©å±•è¿™ä¸ªç±»ï¼Œæ¥ä¸ºè¦å®ä¾‹åŒ–çš„beanä½œä¸€ä¸ªä»£ç†ï¼Œæ¯”å¦‚ä¸ºè¯¥å¯¹è±¡çš„æ‰€æœ‰çš„æ–¹æ³•ä½œä¸€ä¸ªæ‹¦æˆªï¼Œåœ¨è°ƒç”¨å‰åè¾“å‡ºä¸€è¡Œlogï¼Œæ¨¡ä»¿ProxyFactoryBeançš„åŠŸèƒ½ã€‚æ‰©å±•ï¼šSpringBootå†…å®¹èšåˆ</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestFactoryBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;TestFactoryBean.TestFactoryInnerBean&gt; &#123;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> TestFactoryBean.TestFactoryInnerBean <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[FactoryBean] getObject&quot;</span>);    <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestFactoryBean</span>.TestFactoryInnerBean();    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() &#123;    <br>        <span class="hljs-keyword">return</span> TestFactoryBean.TestFactoryInnerBean.class;    <br>    &#125;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> &#123;    <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    <br>    &#125;    <br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestFactoryInnerBean</span>&#123;    <br>    <br>    &#125;    <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="13-SmartInitializingSingleton"><a href="#13-SmartInitializingSingleton" class="headerlink" title="13. SmartInitializingSingleton"></a>13. SmartInitializingSingleton</h3><blockquote><p>org.springframework.beans.factory.SmartInitializingSingleton</p></blockquote><p>è¿™ä¸ªæ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•afterSingletonsInstantiatedï¼Œå…¶ä½œç”¨æ˜¯æ˜¯ åœ¨springå®¹å™¨ç®¡ç†çš„æ‰€æœ‰å•ä¾‹å¯¹è±¡ï¼ˆéæ‡’åŠ è½½å¯¹è±¡ï¼‰åˆå§‹åŒ–å®Œæˆä¹‹åè°ƒç”¨çš„å›è°ƒæ¥å£ã€‚å…¶è§¦å‘æ—¶æœºä¸ºpostProcessAfterInitializationä¹‹åã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·å¯ä»¥æ‰©å±•æ­¤æ¥å£åœ¨å¯¹æ‰€æœ‰å•ä¾‹å¯¹è±¡åˆå§‹åŒ–å®Œæ¯•åï¼Œåšä¸€äº›åç½®çš„ä¸šåŠ¡å¤„ç†ã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSmartInitializingSingleton</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SmartInitializingSingleton</span> &#123;    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterSingletonsInstantiated</span><span class="hljs-params">()</span> &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestSmartInitializingSingleton]&quot;</span>);    <br>    &#125;    <br>&#125;    <br></code></pre></td></tr></table></figure><h3 id="14-CommandLineRunner"><a href="#14-CommandLineRunner" class="headerlink" title="14. CommandLineRunner"></a>14. CommandLineRunner</h3><blockquote><p>org.springframework.boot.CommandLineRunner</p></blockquote><p>è¿™ä¸ªæ¥å£ä¹Ÿåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼šrun(Stringâ€¦ args)ï¼Œè§¦å‘æ—¶æœºä¸ºæ•´ä¸ªé¡¹ç›®å¯åŠ¨å®Œæ¯•åï¼Œè‡ªåŠ¨æ‰§è¡Œã€‚å¦‚æœæœ‰å¤šä¸ªCommandLineRunnerï¼Œå¯ä»¥åˆ©ç”¨@Orderæ¥è¿›è¡Œæ’åºã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·æ‰©å±•æ­¤æ¥å£ï¼Œè¿›è¡Œå¯åŠ¨é¡¹ç›®ä¹‹åä¸€äº›ä¸šåŠ¡çš„é¢„å¤„ç†ã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCommandLineRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> &#123;    <br>    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[TestCommandLineRunner]&quot;</span>);    <br>    &#125;    <br>&#125;    <br></code></pre></td></tr></table></figure><h3 id="15-DisposableBean"><a href="#15-DisposableBean" class="headerlink" title="15. DisposableBean"></a>15. DisposableBean</h3><blockquote><p>org.springframework.beans.factory.DisposableBean</p></blockquote><p>è¿™ä¸ªæ‰©å±•ç‚¹ä¹Ÿåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼šdestroy()ï¼Œå…¶è§¦å‘æ—¶æœºä¸ºå½“æ­¤å¯¹è±¡é”€æ¯æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚è¯´è¿è¡ŒapplicationContext.registerShutdownHookæ—¶ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•ã€‚</p><p>æ‰©å±•æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NormalBeanA</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DisposableBean</span> &#123;    <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;    <br>        System.out.println(<span class="hljs-string">&quot;[DisposableBean] NormalBeanA&quot;</span>);    <br>    &#125;    <br>&#125; <br></code></pre></td></tr></table></figure><h3 id="16-ApplicationListener"><a href="#16-ApplicationListener" class="headerlink" title="16.ApplicationListener"></a>16.ApplicationListener</h3><blockquote><p>org.springframework.context.ApplicationListener</p></blockquote><p>å‡†ç¡®çš„è¯´ï¼Œè¿™ä¸ªåº”è¯¥ä¸ç®—spring&amp;springbootå½“ä¸­çš„ä¸€ä¸ªæ‰©å±•ç‚¹ï¼ŒApplicationListenerå¯ä»¥ç›‘å¬æŸä¸ªäº‹ä»¶çš„eventï¼Œè§¦å‘æ—¶æœºå¯ä»¥ç©¿æ’åœ¨ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æŸä¸ªä¸šåŠ¡äº‹ä»¶ã€‚</p><p>ä½†æ˜¯springå†…éƒ¨ä¹Ÿæœ‰ä¸€äº›å†…ç½®äº‹ä»¶ï¼Œè¿™ç§äº‹ä»¶ï¼Œå¯ä»¥ç©¿æ’åœ¨å¯åŠ¨è°ƒç”¨ä¸­ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæ¥è‡ªå·±åšä¸€äº›å†…ç½®äº‹ä»¶çš„ç›‘å¬å™¨æ¥è¾¾åˆ°å’Œå‰é¢ä¸€äº›è§¦å‘ç‚¹å¤§è‡´ç›¸åŒçš„äº‹æƒ…ã€‚</p><p>æ¥ä¸‹æ¥ç½—åˆ—ä¸‹springä¸»è¦çš„å†…ç½®äº‹ä»¶ï¼š</p><ul><li><p>ContextRefreshedEvent</p><p>ApplicationContext è¢«åˆå§‹åŒ–æˆ–åˆ·æ–°æ—¶ï¼Œè¯¥äº‹ä»¶è¢«å‘å¸ƒã€‚è¿™ä¹Ÿå¯ä»¥åœ¨ConfigurableApplicationContextæ¥å£ä¸­ä½¿ç”¨ refresh()æ–¹æ³•æ¥å‘ç”Ÿã€‚æ­¤å¤„çš„åˆå§‹åŒ–æ˜¯æŒ‡ï¼šæ‰€æœ‰çš„Beanè¢«æˆåŠŸè£…è½½ï¼Œåå¤„ç†Beanè¢«æ£€æµ‹å¹¶æ¿€æ´»ï¼Œæ‰€æœ‰Singleton Bean è¢«é¢„å®ä¾‹åŒ–ï¼ŒApplicationContextå®¹å™¨å·²å°±ç»ªå¯ç”¨ã€‚</p></li><li><p>ContextStartedEvent</p><p>å½“ä½¿ç”¨ ConfigurableApplicationContext ï¼ˆApplicationContextå­æ¥å£ï¼‰æ¥å£ä¸­çš„ start() æ–¹æ³•å¯åŠ¨ ApplicationContextæ—¶ï¼Œè¯¥äº‹ä»¶è¢«å‘å¸ƒã€‚ä½ å¯ä»¥è°ƒæŸ¥ä½ çš„æ•°æ®åº“ï¼Œæˆ–è€…ä½ å¯ä»¥åœ¨æ¥å—åˆ°è¿™ä¸ªäº‹ä»¶åé‡å¯ä»»ä½•åœæ­¢çš„åº”ç”¨ç¨‹åºã€‚</p></li><li><p>ContextStoppedEvent</p><p>å½“ä½¿ç”¨ ConfigurableApplicationContextæ¥å£ä¸­çš„ stop()åœæ­¢ApplicationContext æ—¶ï¼Œå‘å¸ƒè¿™ä¸ªäº‹ä»¶ã€‚ä½ å¯ä»¥åœ¨æ¥å—åˆ°è¿™ä¸ªäº‹ä»¶ååšå¿…è¦çš„æ¸…ç†çš„å·¥ä½œ</p></li><li><p>ContextClosedEvent</p><p>å½“ä½¿ç”¨ ConfigurableApplicationContextæ¥å£ä¸­çš„ close()æ–¹æ³•å…³é—­ ApplicationContext æ—¶ï¼Œè¯¥äº‹ä»¶è¢«å‘å¸ƒã€‚ä¸€ä¸ªå·²å…³é—­çš„ä¸Šä¸‹æ–‡åˆ°è¾¾ç”Ÿå‘½å‘¨æœŸæœ«ç«¯ï¼›å®ƒä¸èƒ½è¢«åˆ·æ–°æˆ–é‡å¯</p></li><li><p>RequestHandledEvent</p><p>è¿™æ˜¯ä¸€ä¸ª web-specific äº‹ä»¶ï¼Œå‘Šè¯‰æ‰€æœ‰ bean HTTP è¯·æ±‚å·²ç»è¢«æœåŠ¡ã€‚åªèƒ½åº”ç”¨äºä½¿ç”¨DispatcherServletçš„Webåº”ç”¨ã€‚åœ¨ä½¿ç”¨Springä½œä¸ºå‰ç«¯çš„MVCæ§åˆ¶å™¨æ—¶ï¼Œå½“Springå¤„ç†ç”¨æˆ·è¯·æ±‚ç»“æŸåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§¦å‘è¯¥äº‹ä»¶</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flag</title>
    <link href="/2025/05/09/Golang/%E5%B8%B8%E7%94%A8%E5%BA%93/flag/"/>
    <url>/2025/05/09/Golang/%E5%B8%B8%E7%94%A8%E5%BA%93/flag/</url>
    
    <content type="html"><![CDATA[<h1 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h1>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
      <category>å¸¸ç”¨åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>å¸¸ç”¨åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gRPC</title>
    <link href="/2024/12/01/Golang/%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/gRPC/"/>
    <url>/2024/12/01/Golang/%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/gRPC/</url>
    
    <content type="html"><![CDATA[<h1 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h1><h2 id="gRPC-ä»‹ç»"><a href="#gRPC-ä»‹ç»" class="headerlink" title="gRPC ä»‹ç»"></a>gRPC ä»‹ç»</h2><p>gPRC å®˜ç½‘ï¼ˆ<a href="https://grpc.io/%EF%BC%89%E4%B8%8A%E7%9A%84">https://grpc.io/ï¼‰ä¸Šçš„</a> Slogan æ˜¯ï¼šA high performance, open source universal RPC frameworkã€‚å°±æ˜¯ï¼šä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºçš„é€šç”¨ RPC æ¡†æ¶ã€‚</p><p>æ”¯æŒå¤šæ•°ä¸»æµè¯­è¨€ï¼šC#ã€C++ã€Dartã€<strong>Go</strong>ã€Javaã€Kotlinã€Nodeã€Objective-Cã€PHPã€Pythonã€Rubyã€‚å…¶ä¸­ Go æ”¯æŒ Windows, Linux, Mac ä¸Šçš„ Go 1.13+ ç‰ˆæœ¬ã€‚</p><p>gRPC æ˜¯ä¸€ä¸ª Google å¼€æºçš„é«˜æ€§èƒ½è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ (RPC) æ¡†æ¶ï¼Œå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œã€‚å®ƒå¯ä»¥é€šè¿‡å¯¹è´Ÿè½½å¹³è¡¡ã€è·Ÿè¸ªã€å¥åº·æ£€æŸ¥å’Œèº«ä»½éªŒè¯çš„å¯æ’æ‹”æ”¯æŒæœ‰æ•ˆåœ°è¿æ¥æ•°æ®ä¸­å¿ƒå†…å’Œè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡ã€‚å®ƒä¹Ÿé€‚ç”¨äºåˆ†å¸ƒå¼è®¡ç®—çš„æœ€åä¸€æ­¥ï¼Œå°†è®¾å¤‡ã€ç§»åŠ¨åº”ç”¨ç¨‹åºå’Œæµè§ˆå™¨ä¸åç«¯æœåŠ¡æ¥ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>é€šè¿‡ <code>goctl</code> å¯ä»¥ä¸€é”®å®‰è£… <code>protoc</code>ï¼Œ<code>protoc-gen-go</code>ï¼Œ<code>protoc-gen-go-grpc</code> ç›¸å…³ç»„ä»¶ï¼Œä½ å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bsh">goctl env check --install --verbose --force<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="Protocol-Buffers"><a href="#Protocol-Buffers" class="headerlink" title="Protocol Buffers"></a>Protocol Buffers</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒgRPC ä½¿ç”¨ Protocol Buffersï¼Œè¿™æ˜¯ Google ç”¨äºåºåˆ—åŒ–ç»“æ„åŒ–æ•°æ®çš„æˆç†Ÿå¼€æºæœºåˆ¶ï¼ˆå°½ç®¡å®ƒå¯ä»¥ä¸ JSON ç­‰å…¶ä»–æ•°æ®æ ¼å¼ä¸€èµ·ä½¿ç”¨ï¼‰ã€‚</p><blockquote><p>Protocol Buffers çš„æ–‡æ¡£ï¼š<a href="https://developers.google.com/protocol-buffers/docs/overview">https://developers.google.com/protocol-buffers/docs/overview</a></p></blockquote><p>ä½¿ç”¨ Protocol Buffers çš„åŸºæœ¬æ­¥éª¤æ˜¯</p><ol><li>ä½¿ç”¨ protocol buffers è¯­æ³•å®šä¹‰æ¶ˆæ¯ï¼Œæ¶ˆæ¯æ˜¯ç”¨äºä¼ é€’çš„æ•°æ®</li><li>ä½¿ç”¨ protocol buffers è¯­æ³•å®šä¹‰æœåŠ¡ï¼ŒæœåŠ¡æ˜¯ RPC æ–¹æ³•çš„é›†åˆï¼Œæ¥ä½¿ç”¨æ¶ˆæ¯</li><li>ä½¿ç”¨ Protocol Bufferç¼– è¯‘å·¥å…· <code>protoc</code> æ¥ç¼–è¯‘ï¼Œç”Ÿæˆå¯¹åº”è¯­è¨€çš„ä»£ç ï¼Œä¾‹å¦‚ Go çš„ä»£ç </li></ol><p>ä½¿ç”¨ Protocol Buffers çš„ç¬¬ä¸€æ­¥æ˜¯åœ¨ <code>.proto</code> æ–‡ä»¶ä¸­å®šä¹‰åºåˆ—åŒ–çš„æ•°æ®çš„ç»“æ„ï¼Œ.proto æ–‡ä»¶æ˜¯æ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ã€‚Protocol Buffers æ•°æ®è¢«ç»“æ„åŒ–ä¸ºæ¶ˆæ¯ï¼Œå…¶ä¸­æ¯æ¡æ¶ˆæ¯éƒ½æ˜¯ä¸€ä¸ªå°çš„ä¿¡æ¯é€»è¾‘è®°å½•ï¼ŒåŒ…å«ä¸€ç³»åˆ—ç§°ä¸ºå­—æ®µçš„ name-value å¯¹ã€‚</p><p>é™¤äº†æ ¸å¿ƒå†…å®¹å¤–ï¼Œ<code>.proto</code> æ–‡ä»¶è¿˜éœ€è¦æŒ‡å®šè¯­æ³•ç‰ˆæœ¬ï¼Œç›®å‰ä¸»æµçš„ä¹Ÿæ˜¯æœ€æ–°çš„ proto3 ç‰ˆæœ¬ã€‚åœ¨ <code>.proto</code> æ–‡ä»¶çš„å¼€å¤´æŒ‡å®šã€‚</p><p>ä¸€ä¸ªç®€å•çš„äº§å“ä¿¡æ¯ç¤ºä¾‹ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-keyword">package</span> user; <span class="hljs-comment">// é»˜è®¤åŒ…å</span><br><br><span class="hljs-keyword">option</span> go_package = <span class="hljs-string">&quot;./user&quot;</span>;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">GetUserReq</span> &#123;<br>    <span class="hljs-type">string</span> id = <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">GetUserResp</span> &#123;<br>    <span class="hljs-type">string</span> id = <span class="hljs-number">1</span>;<br>    <span class="hljs-type">string</span> name = <span class="hljs-number">2</span>;<br>    <span class="hljs-type">string</span> phone = <span class="hljs-number">3</span>;<br>&#125;<br><br><span class="hljs-keyword">service </span><span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">rpc</span> GetUser(GetUserReq) <span class="hljs-keyword">returns</span> (GetUserResp)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>protoc</code> å·¥å…·å°† <code>.proto</code> å®šä¹‰çš„æ¶ˆæ¯å’ŒåŒ…å« rpc æ–¹æ³•çš„æœåŠ¡ç¼–è¯‘ä¸ºç›®æ ‡è¯­è¨€çš„ä»£ç ï¼Œæˆ‘ä»¬é€‰æ‹© Go ä»£ç ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">protoc --go-grpc_out=. --go_out=. ./user.proto<br><span class="hljs-comment"># --go_out *.pb.go ç›®å½•</span><br><span class="hljs-comment"># --go-grpc_out *_grpc.pb.go ç›®å½•</span><br></code></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯ç±»å‹çš„å®šä¹‰"><a href="#æ¶ˆæ¯ç±»å‹çš„å®šä¹‰" class="headerlink" title="æ¶ˆæ¯ç±»å‹çš„å®šä¹‰"></a>æ¶ˆæ¯ç±»å‹çš„å®šä¹‰</h4><p>ä»¥ä¸€ä¸ªç®€å•çš„è¯·æ±‚æ¶ˆæ¯ä¸ºä¾‹ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">SearchRequest</span> &#123;<br>  <span class="hljs-type">string</span> query = <span class="hljs-number">1</span>;<br>  <span class="hljs-type">int32</span> page_number = <span class="hljs-number">2</span>;<br>  <span class="hljs-type">int32</span> result_per_page = <span class="hljs-number">3</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæŒ‡å®šç‰ˆæœ¬ proto3ï¼Œå¦åˆ™ç¼–è¯‘å™¨é»˜è®¤ä¸º proto2ã€‚ç‰ˆæœ¬æŒ‡å®šä¸ºæ–‡ä»¶çš„ç¬¬ä¸€éç©ºç™½ã€éæ³¨é‡Šè¡Œã€‚</p><p>message å…³é”®å­—ç”¨äºå®šä¹‰æ¶ˆæ¯ï¼Œéœ€è¦æŒ‡å®šæ¶ˆæ¯ç±»å‹çš„åç§°ã€‚</p><p>æ¶ˆæ¯ç”±å¤šä¸ªåç§°&#x2F;å€¼å¯¹ç»„æˆï¼Œç§°ä¸ºå­—æ®µï¼Œæ¯ä¸ªå­—æ®µè¦æŒ‡å®šåå­—å’Œç±»å‹ã€‚stringã€int32 æ˜¯å…¸å‹çš„æ ‡é‡ç±»å‹ï¼Œé™¤äº†æ ‡é‡ç±»å‹ protobuf è¿˜æ”¯æŒæ„é€ ç±»å‹ï¼Œä¾‹å¦‚æšä¸¾æˆ–å…¶ä»–æ¶ˆæ¯ç±»å‹ã€‚</p><p>åº”è¯¥ä¸ºæ¯ä¸ªå­—æ®µåˆ†é…å”¯ä¸€çš„å­—æ®µåºå·ï¼Œç”¨äºåœ¨äºŒè¿›åˆ¶ç¼–ç ä¸­æ ‡è¯†è¯¥å­—æ®µã€‚åºå·èŒƒå›´1-15ä¼šæ¶ˆè€—1ä¸ªå­—èŠ‚çš„å­˜å‚¨ï¼Œ16-2047 ä¼šæ¶ˆè€—2ä¸ªå­—èŠ‚ã€‚å› æ­¤åº”è¯¥å°†å¸¸ç”¨çš„å­—æ®µåˆ†é…1-15å­—æ®µåºå·ã€‚ç¼–å·å…¨éƒ¨çš„èŒƒå›´æ˜¯1åˆ°2^29-1ï¼Œå…¶ä¸­19000åˆ°19999æ˜¯ protoç¼–è¯‘å™¨ä¿ç•™åºå·ï¼Œä¸è¦ä½¿ç”¨ã€‚</p><p>æ¶ˆæ¯çš„å­—æ®µåˆ†ä¸ºå•ä¸€å’Œé‡å¤ä¸¤ç§è§„åˆ™ï¼š</p><ul><li><p>å•ä¸€ Singularï¼Œproto3 ä¸­å­—æ®µçš„é»˜è®¤è§„åˆ™ã€‚ä¸€ä¸ªæ¶ˆæ¯ä¸­ä»…å¯ä»¥åŒ…å«0æˆ–1ä¸ªè¯¥å­—æ®µï¼Œå°±æ˜¯å­—æ®µä¸èƒ½é‡å¤ã€‚</p></li><li><p>é‡å¤çš„ repeatedï¼Œè¯¥è§„åˆ™è¯´æ˜æ­¤å­—æ®µå¯ä»¥é‡å¤å¤šæ¬¡ï¼ˆåŒ…å«0æ¬¡ï¼‰ã€‚é‡å¤å€¼çš„é¡ºåºæ˜¯ä¿ç•™çš„ã€‚</p></li></ul><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">message </span><span class="hljs-title class_">SearchRequest</span> &#123;<br>  <span class="hljs-comment">// åŒä¸Šç•¥</span><br>  <span class="hljs-keyword">repeated</span> <span class="hljs-type">string</span> keywords = <span class="hljs-number">4</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>.proto</code> æ–‡ä»¶æ”¯æŒ C&#x2F;C++ é£æ ¼çš„æ³¨é‡Š <code>//</code> å’Œ <code>/* ... */</code></p><h4 id="æ ‡é‡ç±»å‹"><a href="#æ ‡é‡ç±»å‹" class="headerlink" title="æ ‡é‡ç±»å‹"></a>æ ‡é‡ç±»å‹</h4><p>æ ‡é‡æ¶ˆæ¯å­—æ®µå¯ä»¥å…·æœ‰ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ã€‚è¯¥è¡¨æ˜¾ç¤ºäº† .proto æ–‡ä»¶ä¸­æŒ‡å®šçš„ç±»å‹ï¼Œä»¥åŠè‡ªåŠ¨ç”Ÿæˆçš„ç±»ä¸­çš„ç›¸åº”ç±»å‹ï¼š</p><table><thead><tr><th align="left">.proto Type</th><th>è¯´æ˜</th><th align="left">Go Type</th></tr></thead><tbody><tr><td align="left">double</td><td></td><td align="left">float64</td></tr><tr><td align="left">float</td><td></td><td align="left">float32</td></tr><tr><td align="left">int32</td><td>å˜é•¿ç¼–ç ï¼Œå¯¹è´Ÿæ•°è¿›è¡Œç¼–ç æ•ˆç‡ä½ä¸‹ã€‚è‹¥å­—æ®µå¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·æ”¹ç”¨ sint32</td><td align="left">int32</td></tr><tr><td align="left">int64</td><td>å˜é•¿ç¼–ç ï¼Œå¯¹è´Ÿæ•°è¿›è¡Œç¼–ç æ•ˆç‡ä½ä¸‹ã€‚è‹¥å­—æ®µå¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·æ”¹ç”¨ sint64</td><td align="left">int64</td></tr><tr><td align="left">uint32</td><td>å˜é•¿ç¼–ç </td><td align="left">uint32</td></tr><tr><td align="left">uint64</td><td>å˜é•¿ç¼–ç </td><td align="left">uint64</td></tr><tr><td align="left">sint32</td><td>å˜é•¿ç¼–ç ï¼Œå¸¦ç¬¦å·çš„ int å€¼ã€‚è¿™äº›æ¯”å¸¸è§„ int32 æ›´æœ‰æ•ˆåœ°ç¼–ç è´Ÿæ•°</td><td align="left">int32</td></tr><tr><td align="left">sint64</td><td>å˜é•¿ç¼–ç ï¼Œå¸¦ç¬¦å·çš„ int å€¼ã€‚è¿™äº›æ¯”å¸¸è§„ int64 æ›´æœ‰æ•ˆåœ°ç¼–ç è´Ÿæ•°</td><td align="left">int64</td></tr><tr><td align="left">fixed32</td><td>å›ºå®š4ä¸ªå­—èŠ‚ï¼Œå¦‚æœå€¼é€šå¸¸å¤§äº 2^28ï¼Œåˆ™æ¯” uint32 æ›´æœ‰æ•ˆ</td><td align="left">uint32</td></tr><tr><td align="left">fixed64</td><td>å›ºå®š8ä¸ªå­—èŠ‚ï¼Œå¦‚æœå€¼é€šå¸¸å¤§äº 2^56ï¼Œåˆ™æ¯” uint64 æ›´æœ‰æ•ˆ</td><td align="left">uint64</td></tr><tr><td align="left">sfixed32</td><td>å›ºå®š4ä¸ªå­—èŠ‚</td><td align="left">int32</td></tr><tr><td align="left">sfixed64</td><td>å›ºå®š8ä¸ªå­—èŠ‚</td><td align="left">int64</td></tr><tr><td align="left">bool</td><td></td><td align="left">bool</td></tr><tr><td align="left">string</td><td>å§‹ç»ˆåŒ…å« UTF-8 ç¼–ç æˆ– 7 ä½ ASCII æ–‡æœ¬ï¼Œå¹¶ä¸”é•¿åº¦ä¸èƒ½è¶…è¿‡ 2^32</td><td align="left">string</td></tr><tr><td align="left">bytes</td><td>å¯ä»¥åŒ…å«ä¸è¶…è¿‡ 2^32 çš„ä»»æ„å­—èŠ‚åºåˆ—</td><td align="left">[]byte</td></tr></tbody></table><p>è§£ææ¶ˆæ¯æ—¶ï¼Œå¦‚æœç¼–ç çš„æ¶ˆæ¯ä¸åŒ…å«ç‰¹å®šå…ƒç´ ï¼Œåˆ™è§£æå¯¹è±¡ä¸­çš„ç›¸åº”å­—æ®µå°†è®¾ç½®ä¸ºè¯¥å­—æ®µçš„é»˜è®¤å€¼ã€‚è¿™äº›é»˜è®¤å€¼æ˜¯åŸºäºç±»å‹çš„ï¼š</p><ul><li>å¯¹äºå­—ç¬¦ä¸²ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li><li>å¯¹äºå­—èŠ‚ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—èŠ‚ã€‚</li><li>å¯¹äºå¸ƒå°”å€¼ï¼Œé»˜è®¤å€¼ä¸º falseã€‚</li><li>å¯¹äºæ•°å­—ç±»å‹ï¼Œé»˜è®¤å€¼ä¸ºé›¶ã€‚</li><li>å¯¹äºæšä¸¾ï¼Œé»˜è®¤å€¼æ˜¯ç¬¬ä¸€ä¸ªå®šä¹‰çš„æšä¸¾å€¼ï¼Œå¿…é¡»ä¸º 0ã€‚</li><li>å¯¹äºæ¶ˆæ¯å­—æ®µï¼Œæœªè®¾ç½®è¯¥å­—æ®µã€‚å®ƒçš„ç¡®åˆ‡å€¼å–å†³äºè¯­è¨€ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç”Ÿæˆçš„ä»£ç æŒ‡å—ã€‚</li><li>é‡å¤å­—æ®µçš„é»˜è®¤å€¼ä¸ºç©ºï¼ˆé€šå¸¸æ˜¯ç›¸åº”è¯­è¨€çš„ç©ºåˆ—è¡¨ï¼‰ã€‚</li></ul><h5 id="æšä¸¾å€¼"><a href="#æšä¸¾å€¼" class="headerlink" title="æšä¸¾å€¼"></a>æšä¸¾å€¼</h5><p>åœ¨å®šä¹‰æ¶ˆæ¯ç±»å‹æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å…¶å­—æ®µä¹‹ä¸€ä»…å…·æœ‰é¢„å®šä¹‰çš„å€¼åˆ—è¡¨ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨è¦ä¸ºæ¯ä¸ª SearchRequest æ·»åŠ ä¸€ä¸ª <code>corpus</code> å­—æ®µï¼Œå…¶ä¸­å€¼å¯ä»¥æ˜¯ UNIVERSALã€WEBã€IMAGESã€LOCALã€NEWSã€PRODUCTS æˆ– VIDEOã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨æ¶ˆæ¯å®šä¹‰ä¸­æ·»åŠ ä¸€ä¸ªæšä¸¾æ¥éå¸¸ç®€å•åœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ¯ä¸ªå¯èƒ½çš„å€¼éƒ½æœ‰ä¸€ä¸ªå¸¸é‡ã€‚</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">message </span><span class="hljs-title class_">SearchRequest</span> &#123;<br>  <span class="hljs-comment">// åŒä¸Šç•¥</span><br>  <span class="hljs-keyword">enum </span><span class="hljs-title class_">Corpus</span> &#123;<br>    UNIVERSAL = <span class="hljs-number">0</span>;<br>    WEB = <span class="hljs-number">1</span>;<br>    IMAGES = <span class="hljs-number">2</span>;<br>    LOCAL = <span class="hljs-number">3</span>;<br>    NEWS = <span class="hljs-number">4</span>;<br>    PRODUCTS = <span class="hljs-number">5</span>;<br>    VIDEO = <span class="hljs-number">6</span>;<br>  &#125;<br>  Corpus corpus = <span class="hljs-number">4</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æšä¸¾å€¼åˆ—è¡¨çš„ç¬¬ä¸€å¸¸é‡å€¼å¿…é¡»ä¸º0ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„å¤„ç†é»˜è®¤å€¼ã€‚ï¼ˆä¹Ÿä¸ºäº†å‘ä¸‹å…¼å®¹ï¼‰</p><p>ä¹Ÿå¯ä»¥ä¸ºåŒä¸€ä¸ªæšä¸¾å€¼åˆ†é…ä¸åŒçš„å¸¸é‡ï¼Œç§°ä¸ºåˆ«åã€‚éœ€è¦ä½¿ç”¨é€‰é¡¹ <code>option allow_alias = true</code> æ¥å¯ç”¨åˆ«åè®¾ç½®ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">message </span><span class="hljs-title class_">MyMessage1</span> &#123;<br>  <span class="hljs-keyword">enum </span><span class="hljs-title class_">EnumAllowingAlias</span> &#123;<br>    <span class="hljs-keyword">option</span> allow_alias = <span class="hljs-literal">true</span>;<br>    UNKNOWN = <span class="hljs-number">0</span>;<br>    STARTED = <span class="hljs-number">1</span>;<br>    RUNNING = <span class="hljs-number">1</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä¿ç•™å€¼"><a href="#ä¿ç•™å€¼" class="headerlink" title="ä¿ç•™å€¼"></a>ä¿ç•™å€¼</h5><p>å½“æŸäº›å­—æ®µä¸å†ä½¿ç”¨æ—¶ï¼Œä¾‹å¦‚æ›´æ–°æ¶ˆæ¯ç±»å‹æ—¶ç§»é™¤äº†æŸäº›å­—æ®µï¼Œä¸ºäº†é˜²æ­¢å…¶ä»–äººé‡æ–°ä½¿ç”¨äº†ä¹‹å‰çš„å­—æ®µåæˆ–å­—æ®µåºå·è€Œå¯¼è‡´é€»è¾‘æ··ä¹±çš„é—®é¢˜ï¼Œå¯ä»¥æŠŠè¿™äº›ä¸ç”¨çš„å­—æ®µè®¾ç½®ä¸ºä¿ç•™å­—æ®µï¼Œå…³é”®å­— <code>reserved</code> ç”¨æ¥è®¾ç½®ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">enum </span><span class="hljs-title class_">Foo</span> &#123;<br>  reserved <span class="hljs-number">2</span>, <span class="hljs-number">15</span>, <span class="hljs-number">9</span> to <span class="hljs-number">11</span>, <span class="hljs-number">40</span> to max;<br>  reserved <span class="hljs-string">&quot;FOO&quot;</span>, <span class="hljs-string">&quot;BAR&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œä»¥ä¸Šçš„åºå·å’Œå­—æ®µåå°±ä¸èƒ½åç»­ä½¿ç”¨äº†ï¼Œé¿å…äº†é€»è¾‘æ··ä¹±ã€‚</p><h5 id="ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹"><a href="#ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹" class="headerlink" title="ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹"></a>ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹</h5><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">message </span><span class="hljs-title class_">SearchResponse</span> &#123;<br>  <span class="hljs-keyword">repeated</span> Result results = <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">Result</span> &#123;<br>  <span class="hljs-type">string</span> url = <span class="hljs-number">1</span>;<br>  <span class="hljs-type">string</span> title = <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">repeated</span> <span class="hljs-type">string</span> snippets = <span class="hljs-number">3</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å°†ä¸åŒç±»å‹çš„æ¶ˆæ¯å®šä¹‰åœ¨ä¸åŒçš„ .proto æ–‡ä»¶ä¸­ï¼Œéœ€è¦æ—¶å¯¼å…¥è¿›æ¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pro">import &quot;myproject/other_protos.proto&quot;;<br></code></pre></td></tr></table></figure><h5 id="æœªçŸ¥å­—æ®µ"><a href="#æœªçŸ¥å­—æ®µ" class="headerlink" title="æœªçŸ¥å­—æ®µ"></a>æœªçŸ¥å­—æ®µ</h5><p>æœªçŸ¥å­—æ®µæ˜¯æ ¼å¼è‰¯å¥½çš„ Protocol Buffer åºåˆ—åŒ–æ•°æ®ï¼Œè¡¨ç¤ºè§£æå™¨æ— æ³•è¯†åˆ«çš„å­—æ®µã€‚ä¾‹å¦‚ï¼Œå½“æ—§äºŒè¿›åˆ¶æ–‡ä»¶ç”¨æ–°å­—æ®µè§£ææ–°äºŒè¿›åˆ¶æ–‡ä»¶å‘é€çš„æ•°æ®æ—¶ï¼Œè¿™äº›æ–°å­—æ®µå°†æˆä¸ºæ—§äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æœªçŸ¥å­—æ®µã€‚</p><p>æœ€åˆï¼Œproto3 æ¶ˆæ¯åœ¨è§£æè¿‡ç¨‹ä¸­æ€»æ˜¯ä¸¢å¼ƒæœªçŸ¥å­—æ®µï¼Œä½†åœ¨ 3.5 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬é‡æ–°å¼•å…¥äº†ä¿ç•™æœªçŸ¥å­—æ®µä»¥åŒ¹é… proto2 è¡Œä¸ºã€‚åœ¨ 3.5 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒæœªçŸ¥å­—æ®µåœ¨è§£ææœŸé—´ä¿ç•™å¹¶åŒ…å«åœ¨åºåˆ—åŒ–è¾“å‡ºä¸­ã€‚</p><h5 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h5><p>Any æ¶ˆæ¯ç±»å‹å…è®¸æ‚¨å°†æ¶ˆæ¯ç”¨ä½œåµŒå…¥ç±»å‹ï¼Œè€Œæ— éœ€å®šä¹‰å®ƒä»¬çš„ .protoã€‚ Any åŒ…å«ä½œä¸º <code>Bytes</code> çš„ä»»æ„åºåˆ—åŒ–æ¶ˆæ¯ï¼Œä»¥åŠå……å½“å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦å¹¶è§£æä¸ºè¯¥æ¶ˆæ¯ç±»å‹çš„ URLã€‚è¦ä½¿ç”¨ Any ç±»å‹ï¼Œæ‚¨éœ€è¦å¯¼å…¥ google&#x2F;protobuf&#x2F;any.protoã€‚</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;google/protobuf/any.proto&quot;</span>;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">ErrorStatus</span> &#123;<br>  <span class="hljs-type">string</span> message = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">repeated</span> google.protobuf.Any details = <span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Onef"><a href="#Onef" class="headerlink" title="Onef"></a>Onef</h5><p>å¦‚æœæ‚¨æœ‰ä¸€æ¡åŒ…å«å¤šä¸ªå­—æ®µçš„æ¶ˆæ¯ï¼Œå¹¶ä¸”æœ€å¤šåŒæ—¶è®¾ç½®ä¸€ä¸ªå­—æ®µï¼Œæ‚¨å¯ä»¥å¼ºåˆ¶æ‰§è¡Œæ­¤è¡Œä¸ºå¹¶ä½¿ç”¨ <code>oneof</code> åŠŸèƒ½èŠ‚çœå†…å­˜ã€‚</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">message </span><span class="hljs-title class_">SampleMessage</span> &#123;<br>  <span class="hljs-keyword">oneof</span> test_oneof &#123;<br>    <span class="hljs-type">string</span> name = <span class="hljs-number">4</span>;<br>    SubMessage sub_message = <span class="hljs-number">9</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h5><p>å¦‚æœæ‚¨æƒ³åˆ›å»ºå…³è”æ˜ å°„ä½œä¸ºæ•°æ®å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œprotocol buffers æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„å¿«æ·è¯­æ³•ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">map&lt;key_type, value_type&gt; map_field = N;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">map&lt;<span class="hljs-type">string</span>, Project&gt; projects = <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure><h4 id="è¯­æ³•æŒ‡å¯¼"><a href="#è¯­æ³•æŒ‡å¯¼" class="headerlink" title="è¯­æ³•æŒ‡å¯¼"></a>è¯­æ³•æŒ‡å¯¼</h4><h5 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h5><p>æ‚¨å¯ä»¥å°†å¯é€‰çš„ <code>package</code> è¯´æ˜ç¬¦æ·»åŠ åˆ° .proto æ–‡ä»¶ä¸­ï¼Œä»¥é˜²æ­¢åè®®æ¶ˆæ¯ç±»å‹ä¹‹é—´çš„åç§°å†²çªã€‚</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">package</span> foo.bar;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">Open</span> &#123; ... &#125;<br></code></pre></td></tr></table></figure><p>åœ¨ GO ä¸­ï¼Œè¯¥è½¯ä»¶åŒ…è¢«ç”¨ä½œ GO è½¯ä»¶åŒ…åç§°ï¼Œé™¤éæ‚¨åœ¨ .proto æ–‡ä»¶ä¸­æ˜ç¡®æä¾› <code>option go_package</code>ã€‚</p><h5 id="æœåŠ¡å®šä¹‰"><a href="#æœåŠ¡å®šä¹‰" class="headerlink" title="æœåŠ¡å®šä¹‰"></a>æœåŠ¡å®šä¹‰</h5><p>å¦‚æœæ‚¨æƒ³åœ¨ RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ç³»ç»Ÿä¸­ä½¿ç”¨æ‚¨çš„æ¶ˆæ¯ç±»å‹ï¼Œæ‚¨å¯ä»¥åœ¨ .proto æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ª RPC æœåŠ¡æ¥å£ï¼Œå¹¶ä¸”åè®®ç¼“å†²åŒºç¼–è¯‘å™¨å°†ä»¥æ‚¨é€‰æ‹©çš„è¯­è¨€ç”ŸæˆæœåŠ¡æ¥å£ä»£ç å’Œå­˜æ ¹ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³ä½¿ç”¨è·å– SearchRequest å¹¶è¿”å› SearchResponse çš„æ–¹æ³•å®šä¹‰ RPC æœåŠ¡ï¼Œæ‚¨å¯ä»¥åœ¨ .proto æ–‡ä»¶ä¸­å®šä¹‰å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">service </span><span class="hljs-title class_">SearchService</span> &#123;<br>  <span class="hljs-function"><span class="hljs-keyword">rpc</span> Search(SearchRequest) <span class="hljs-keyword">returns</span> (SearchResponse)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ Proto Buffers ä¸€èµ·ä½¿ç”¨çš„æœ€ç›´æ¥çš„ RPC ç³»ç»Ÿæ˜¯ gRPCï¼šç”± Google å¼€å‘çš„ä¸€ç§è¯­è¨€å’Œå¹³å°ä¸­ç«‹çš„å¼€æº RPC ç³»ç»Ÿã€‚ gRPC ç‰¹åˆ«é€‚ç”¨äºåè®®ç¼“å†²åŒºï¼Œå¹¶å…è®¸æ‚¨ä½¿ç”¨ç‰¹æ®Šçš„åè®®ç¼“å†²åŒºç¼–è¯‘å™¨æ’ä»¶ç›´æ¥ä» .proto æ–‡ä»¶ç”Ÿæˆç›¸å…³çš„ RPC ä»£ç ã€‚</p><h5 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h5><p>.proto æ–‡ä»¶ä¸­æ”¯æŒå®šä¹‰é€‰é¡¹ã€‚å…¨éƒ¨çš„é€‰é¡¹å®šä¹‰åœ¨ <code>google/protobuf/descriptor.proto</code> ä¸­ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨ option go_package é€‰é¡¹æ¥æ§åˆ¶ç”Ÿæˆçš„ go ä»£ç æ‰€åœ¨çš„ packageã€‚</p><h3 id="gRPC-æ”¯æŒå››ç§å®šä¹‰æœåŠ¡çš„æ–¹æ³•"><a href="#gRPC-æ”¯æŒå››ç§å®šä¹‰æœåŠ¡çš„æ–¹æ³•" class="headerlink" title="gRPC æ”¯æŒå››ç§å®šä¹‰æœåŠ¡çš„æ–¹æ³•"></a>gRPC æ”¯æŒå››ç§å®šä¹‰æœåŠ¡çš„æ–¹æ³•</h3><h4 id="ä¸€å…ƒ-RPC"><a href="#ä¸€å…ƒ-RPC" class="headerlink" title="ä¸€å…ƒ RPC"></a>ä¸€å…ƒ RPC</h4><p>é¦–å…ˆè€ƒè™‘æœ€ç®€å•çš„ RPC ç±»å‹ï¼Œå…¶ä¸­å®¢æˆ·ç«¯å‘é€å•ä¸ªè¯·æ±‚å¹¶è¿”å›å•ä¸ªå“åº”ã€‚</p><ol><li>ä¸€æ—¦å®¢æˆ·ç«¯è°ƒç”¨äº†ä¸€ä¸ªå­˜æ ¹æ–¹æ³•ï¼ŒæœåŠ¡å™¨å°±ä¼šè¢«é€šçŸ¥è¯¥ RPC å·²è¢«è°ƒç”¨ï¼Œå…¶ä¸­åŒ…å«è¯¥è°ƒç”¨çš„å®¢æˆ·ç«¯å…ƒæ•°æ®ã€æ–¹æ³•åç§°å’ŒæŒ‡å®šçš„æˆªæ­¢æ—¥æœŸï¼ˆå¦‚æœé€‚ç”¨ï¼‰ã€‚</li><li>ç„¶åï¼ŒæœåŠ¡å™¨å¯ä»¥ç«‹å³å‘å›è‡ªå·±çš„åˆå§‹å…ƒæ•°æ®ï¼ˆå¿…é¡»åœ¨ä»»ä½•å“åº”ä¹‹å‰å‘é€ï¼‰ï¼Œæˆ–è€…ç­‰å¾…å®¢æˆ·ç«¯çš„è¯·æ±‚æ¶ˆæ¯ã€‚é¦–å…ˆå‘ç”Ÿçš„æ˜¯ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„ã€‚</li><li>ä¸€æ—¦æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ¶ˆæ¯ï¼Œå®ƒå°±ä¼šæ‰§è¡Œä»»ä½•å¿…è¦çš„å·¥ä½œæ¥åˆ›å»ºå’Œå¡«å……å“åº”ã€‚ç„¶åå°†å“åº”è¿åŒçŠ¶æ€è¯¦ç»†ä¿¡æ¯ï¼ˆçŠ¶æ€ä»£ç å’Œå¯é€‰çŠ¶æ€æ¶ˆæ¯ï¼‰å’Œå¯é€‰å°¾éšå…ƒæ•°æ®ä¸€èµ·è¿”å›ï¼ˆå¦‚æœæˆåŠŸï¼‰ç»™å®¢æˆ·ç«¯ã€‚</li><li>å¦‚æœå“åº”çŠ¶æ€ä¸º OKï¼Œåˆ™å®¢æˆ·ç«¯å¾—åˆ°å“åº”ï¼Œä»è€Œå®Œæˆå®¢æˆ·ç«¯çš„è°ƒç”¨ã€‚</li></ol><blockquote><p>ä¸€å…ƒ  RPCï¼Œå…¶ä¸­å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å•ä¸ªè¯·æ±‚å¹¶è·å¾—å•ä¸ªå“åº”ï¼Œå°±åƒæ­£å¸¸çš„å‡½æ•°è°ƒç”¨ä¸€æ ·</p></blockquote><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-function"><span class="hljs-keyword">rpc</span> SayHello(HelloRequest) <span class="hljs-keyword">returns</span> (HelloResponse)</span>;<br></code></pre></td></tr></table></figure><h4 id="æœåŠ¡å™¨æµå¼-RPC"><a href="#æœåŠ¡å™¨æµå¼-RPC" class="headerlink" title="æœåŠ¡å™¨æµå¼ RPC"></a>æœåŠ¡å™¨æµå¼ RPC</h4><p>æœåŠ¡å™¨æµå¼ RPC ç±»ä¼¼äºä¸€å…ƒ RPCï¼Œé™¤äº†æœåŠ¡å™¨è¿”å›æ¶ˆæ¯æµä»¥å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å‘é€æ‰€æœ‰æ¶ˆæ¯åï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€è¯¦ç»†ä¿¡æ¯ï¼ˆçŠ¶æ€ä»£ç å’Œå¯é€‰çŠ¶æ€æ¶ˆæ¯ï¼‰å’Œå¯é€‰çš„å°¾éšå…ƒæ•°æ®å°†å‘é€åˆ°å®¢æˆ·ç«¯ã€‚è¿™æ ·å°±å®Œæˆäº†æœåŠ¡å™¨ç«¯çš„å¤„ç†ã€‚å®¢æˆ·ç«¯åœ¨æ‹¥æœ‰æ‰€æœ‰æœåŠ¡å™¨æ¶ˆæ¯åå®Œæˆã€‚</p><blockquote><p>æœåŠ¡å™¨æµå¼ RPCï¼Œå…¶ä¸­å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶è·å–æµä»¥è¯»å›ä¸€ç³»åˆ—æ¶ˆæ¯ã€‚å®¢æˆ·ç«¯ä»è¿”å›çš„æµä¸­è¯»å–ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ¶ˆæ¯ä¸ºæ­¢ã€‚ gRPC ä¿è¯å•ä¸ª RPC è°ƒç”¨ä¸­çš„æ¶ˆæ¯é¡ºåºã€‚</p></blockquote><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-function"><span class="hljs-keyword">rpc</span> LotsOfReplies(HelloRequest) <span class="hljs-keyword">returns</span> (stream HelloResponse)</span>;<br></code></pre></td></tr></table></figure><h4 id="å®¢æˆ·ç«¯æµå¼-RPC"><a href="#å®¢æˆ·ç«¯æµå¼-RPC" class="headerlink" title="å®¢æˆ·ç«¯æµå¼ RPC"></a>å®¢æˆ·ç«¯æµå¼ RPC</h4><p>å®¢æˆ·ç«¯æµå¼ RPC ç±»ä¼¼äºä¸€å…ƒ RPCï¼Œä¸åŒä¹‹å¤„åœ¨äºå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯æµè€Œä¸æ˜¯å•ä¸ªæ¶ˆæ¯ã€‚æœåŠ¡å™¨å“åº”ä¸€æ¡æ¶ˆæ¯ï¼ˆè¿åŒå…¶çŠ¶æ€è¯¦ç»†ä¿¡æ¯å’Œå¯é€‰çš„å°¾éšå…ƒæ•°æ®ï¼‰ï¼Œé€šå¸¸ä½†ä¸ä¸€å®šæ˜¯åœ¨å®ƒæ”¶åˆ°æ‰€æœ‰å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä¹‹å</p><blockquote><p>å®¢æˆ·ç«¯æµå¼ RPCï¼Œå…¶ä¸­å®¢æˆ·ç«¯å†™å…¥ä¸€ç³»åˆ—æ¶ˆæ¯å¹¶å°†å®ƒä»¬å‘é€åˆ°æœåŠ¡å™¨ï¼Œå†æ¬¡ä½¿ç”¨æä¾›çš„æµã€‚ä¸€æ—¦å®¢æˆ·ç«¯å®Œæˆäº†æ¶ˆæ¯çš„å†™å…¥ï¼Œå®ƒå°±ä¼šç­‰å¾…æœåŠ¡å™¨è¯»å–å®ƒä»¬å¹¶è¿”å›å®ƒçš„å“åº”ã€‚ gRPC å†æ¬¡ä¿è¯äº†å•ä¸ª RPC è°ƒç”¨ä¸­çš„æ¶ˆæ¯é¡ºåºã€‚</p></blockquote><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-function"><span class="hljs-keyword">rpc</span> LotsOfGreetings(stream HelloRequest) <span class="hljs-keyword">returns</span> (HelloResponse)</span>;<br></code></pre></td></tr></table></figure><h4 id="åŒå‘æµå¼-RPC"><a href="#åŒå‘æµå¼-RPC" class="headerlink" title="åŒå‘æµå¼ RPC"></a>åŒå‘æµå¼ RPC</h4><p>åœ¨åŒå‘æµå¼ RPC ä¸­ï¼Œè°ƒç”¨ç”±è°ƒç”¨æ–¹æ³•çš„å®¢æˆ·ç«¯å’Œæ¥æ”¶å®¢æˆ·ç«¯å…ƒæ•°æ®ã€æ–¹æ³•åç§°å’Œæˆªæ­¢æ—¥æœŸçš„æœåŠ¡å™¨å‘èµ·ã€‚æœåŠ¡å™¨å¯ä»¥é€‰æ‹©å‘å›å…¶åˆå§‹å…ƒæ•°æ®æˆ–ç­‰å¾…å®¢æˆ·ç«¯å¼€å§‹æµå¼ä¼ è¾“æ¶ˆæ¯ã€‚</p><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æµå¤„ç†æ˜¯ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„ã€‚<strong>ç”±äºè¿™ä¸¤ä¸ªæµæ˜¯ç‹¬ç«‹çš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ä»¥ä»»æ„é¡ºåºè¯»å†™æ¶ˆæ¯</strong>ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯ä»¥ç­‰åˆ°å®ƒæ”¶åˆ°å®¢æˆ·ç«¯çš„æ‰€æœ‰æ¶ˆæ¯åå†å†™å…¥å®ƒçš„æ¶ˆæ¯ï¼Œæˆ–è€…æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯ä»¥ç© â€œping-pongâ€â€”â€”æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åå‘å›å“åº”ï¼Œç„¶åå®¢æˆ·ç«¯å‘é€åŸºäºå“åº”çš„å¦ä¸€ä¸ªè¯·æ±‚ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><blockquote><p>åŒå‘æµå¼ RPCï¼ŒåŒæ–¹ä½¿ç”¨è¯»å†™æµå‘é€ä¸€ç³»åˆ—æ¶ˆæ¯ã€‚è¿™ä¸¤ä¸ªæµç‹¬ç«‹è¿è¡Œï¼Œå› æ­¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥æŒ‰ç…§ä»–ä»¬å–œæ¬¢çš„ä»»ä½•é¡ºåºè¯»å–å’Œå†™å…¥ï¼šä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨å†™å…¥å“åº”ä¹‹å‰ç­‰å¾…æ¥æ”¶æ‰€æœ‰å®¢æˆ·ç«¯æ¶ˆæ¯ï¼Œæˆ–è€…å®ƒå¯ä»¥äº¤æ›¿è¯»å–æ¶ˆæ¯ç„¶åå†™å…¥æ¶ˆæ¯ï¼Œæˆ–å…¶ä»–ä¸€äº›è¯»å–å’Œå†™å…¥çš„ç»„åˆã€‚ä¿ç•™æ¯ä¸ªæµä¸­æ¶ˆæ¯çš„é¡ºåºã€‚</p></blockquote><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-function"><span class="hljs-keyword">rpc</span> BidiHello(stream HelloRequest) <span class="hljs-keyword">returns</span> (stream HelloResponse)</span><br></code></pre></td></tr></table></figure><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯ gRPC å®¢æˆ·ç«¯è°ƒç”¨ gRPC æœåŠ¡ç«¯æ–¹æ³•çš„è¿‡ç¨‹ã€‚åŒºåˆ«äºä¸åŒçš„4ç§æœåŠ¡å®šä¹‰ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><h4 id="æˆªæ­¢æ—¥æœŸ-è¶…æ—¶"><a href="#æˆªæ­¢æ—¥æœŸ-è¶…æ—¶" class="headerlink" title="æˆªæ­¢æ—¥æœŸ&#x2F;è¶…æ—¶"></a>æˆªæ­¢æ—¥æœŸ&#x2F;è¶…æ—¶</h4><p>gRPC å…è®¸å®¢æˆ·ç«¯æŒ‡å®šåœ¨ RPC å›  DEADLINE_EXCEEDED é”™è¯¯è€Œç»ˆæ­¢ä¹‹å‰ï¼Œä»–ä»¬æ„¿æ„ç­‰å¾… RPC å®Œæˆå¤šé•¿æ—¶é—´ã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨å¯ä»¥æŸ¥è¯¢ç‰¹å®šçš„ RPC æ˜¯å¦å·²è¶…æ—¶ï¼Œæˆ–è€…è¿˜å‰©å¤šå°‘æ—¶é—´æ¥å®Œæˆ RPCã€‚æŒ‡å®šæœŸé™æˆ–è¶…æ—¶æ˜¯ç‰¹å®šäºè¯­è¨€çš„ï¼šä¸€äº›è¯­è¨€ API æ ¹æ®è¶…æ—¶ï¼ˆæŒç»­æ—¶é—´ï¼‰å·¥ä½œï¼Œè€Œä¸€äº›è¯­è¨€ API æ ¹æ®æœŸé™ï¼ˆå›ºå®šæ—¶é—´ç‚¹ï¼‰å·¥ä½œï¼Œå¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰é»˜è®¤æœŸé™ã€‚</p><h4 id="RPC-ç»ˆæ­¢"><a href="#RPC-ç»ˆæ­¢" class="headerlink" title="RPC ç»ˆæ­¢"></a>RPC ç»ˆæ­¢</h4><p>åœ¨ gRPC ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯¹è°ƒç”¨æ˜¯å¦æˆåŠŸåšå‡ºç‹¬ç«‹çš„æœ¬åœ°åˆ¤æ–­ï¼Œå¹¶ä¸”å®ƒä»¬çš„ç»“è®ºå¯èƒ½ä¸åŒ¹é…ã€‚è¿™æ„å‘³ç€ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æœ‰ä¸€ä¸ª RPC åœ¨æœåŠ¡å™¨ç«¯æˆåŠŸå®Œæˆï¼ˆâ€œæˆ‘å·²ç»å‘é€äº†æ‰€æœ‰å“åº”ï¼â€ï¼‰ä½†åœ¨å®¢æˆ·ç«¯å¤±è´¥ï¼ˆâ€œå“åº”åœ¨æˆ‘çš„æˆªæ­¢æ—¥æœŸä¹‹ååˆ°è¾¾ï¼â€ï¼‰ã€‚æœåŠ¡å™¨ä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯å‘é€æ‰€æœ‰è¯·æ±‚ä¹‹å‰å†³å®šå®Œæˆã€‚</p><h4 id="å–æ¶ˆ-RPC"><a href="#å–æ¶ˆ-RPC" class="headerlink" title="å–æ¶ˆ RPC"></a>å–æ¶ˆ RPC</h4><p>å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨éƒ½å¯ä»¥éšæ—¶å–æ¶ˆ RPCã€‚å–æ¶ˆä¼šç«‹å³ç»ˆæ­¢ RPCï¼Œä»¥ä¾¿ä¸å†è¿›è¡Œä»»ä½•å·¥ä½œã€‚</p><h2 id="HTTP2"><a href="#HTTP2" class="headerlink" title="HTTP2"></a>HTTP2</h2><blockquote><p> http2 æ˜¯ gRPC ä¸­çš„å…³é”®åè®®</p></blockquote><h3 id="HTTP1-å­˜åœ¨çš„é—®é¢˜"><a href="#HTTP1-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="HTTP1 å­˜åœ¨çš„é—®é¢˜"></a>HTTP1 å­˜åœ¨çš„é—®é¢˜</h3><ul><li>ä½æ•ˆçš„ TCP åˆ©ç”¨<ul><li>è¿æ¥æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨</li></ul></li><li>è‡ƒè‚¿çš„æ¶ˆæ¯é¦–éƒ¨<ul><li>è¯·æ±‚è¡Œï¼ˆurlã€è¯·æ±‚å¤´ã€ç‰ˆæœ¬ï¼‰</li><li>é¦–éƒ¨è¡Œ</li><li>ç©ºè¡Œ</li><li>å®ä½“ä¸»ä½“</li></ul></li><li>æ˜æ–‡ä¼ è¾“<ul><li>å¯ä»¥é€šè¿‡åŠ  SSL è¯ä¹¦ï¼Œå°†è¯·æ±‚è½¬æˆ HTTPS</li></ul></li><li>ä¼ è¾“æ•ˆç‡ä½</li></ul><h3 id="HTP2-æ”¹è¿›çš„åœ°æ–¹"><a href="#HTP2-æ”¹è¿›çš„åœ°æ–¹" class="headerlink" title="HTP2 æ”¹è¿›çš„åœ°æ–¹"></a>HTP2 æ”¹è¿›çš„åœ°æ–¹</h3><ul><li><p>ä¼ è¾“çš„æ”¹è¿›</p><ul><li>HTTP1 ä¸­ä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”ä¸èƒ½åœæ­¢è§£æ</li><li>HTTP1 ä¸­å¯¹äºæœåŠ¡ç«¯æ¥è¯´æ— æ³•é¢„åˆ¤ä½¿ç”¨å¤šå°‘å†…å­˜</li><li>HTTP1 å†—ä½™è¿‡å¤šçš„ LF åˆ†éš”ç¬¦</li><li>HTTP2 ä¸­tcpè¿æ¥ä¹‹åä¸ä¼šæ–­æ‰<ul><li>ä¼šå°†ä¸€æ¬¡è¯·æ±‚åˆ†æˆä¸€å®šæ•°é‡çš„å¸§ï¼Œç»™å…³é”®å¸§æ‰“ä¸Šæ ‡è¯†ï¼Œç„¶åå®¢æˆ·ç«¯ä¼šæ ¹æ®è¿™äº›æ ‡è¯†ç»„è£…æ•°æ®</li></ul></li></ul></li><li><p>è¯·æ±‚å¤´ä¼˜åŒ–</p><ul><li><p>HTTP1 æ˜¯å±äºæ— çŠ¶æ€çš„ï¼Œæ¯æ¬¡éƒ½éœ€è¦å°†æ‰€æœ‰è¯·æ±‚å¤´å‘é€åˆ°æœåŠ¡æ–¹ï¼ˆ http2 åœ¨å°†è¯·æ±‚å¤´å¸§å‘é€åˆ°æœåŠ¡åï¼Œåç»­çš„å¸§åªä¼šå‘é€ä¸åŒçš„ä¸œè¥¿ï¼‰</p><p><img src="https://i.imgur.com/qqbaMCU.png" alt="image-20241031212104738"></p></li><li><p>å¤šè·¯å¤ç”¨</p><ul><li>HTTP1 è¿æ¥æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ‰“å¼€ä¸€ä¸ªç½‘é¡µä¼šå‘èµ·å¤šæ¬¡è¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚å®Œä¹‹åå°±ä¼šå…³é—­</li><li>HTTP2 åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­åªä¼šå»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œåç»­çš„è¯·æ±‚éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥è¿›è¡Œå‘é€</li></ul></li><li><p>æœåŠ¡ç«¯å¯æ¨é€</p><ul><li><p>HTTP1 ä¸æ”¯æŒ</p></li><li><p>HTTP2 æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¼šä¿æŒé•¿è¿æ¥</p></li></ul></li></ul></li></ul><h2 id="gRPC-å®æˆ˜"><a href="#gRPC-å®æˆ˜" class="headerlink" title="gRPC å®æˆ˜"></a>gRPC å®æˆ˜</h2><h3 id="gRPC-çš„æœåŠ¡ç«¯è¿æ¥è°ƒåº¦å®ç°åŸç†åˆ†æ"><a href="#gRPC-çš„æœåŠ¡ç«¯è¿æ¥è°ƒåº¦å®ç°åŸç†åˆ†æ" class="headerlink" title="gRPC çš„æœåŠ¡ç«¯è¿æ¥è°ƒåº¦å®ç°åŸç†åˆ†æ"></a>gRPC çš„æœåŠ¡ç«¯è¿æ¥è°ƒåº¦å®ç°åŸç†åˆ†æ</h3><h4 id="è‡ªå®šä¹‰æœåŠ¡åŠ è½½"><a href="#è‡ªå®šä¹‰æœåŠ¡åŠ è½½" class="headerlink" title="è‡ªå®šä¹‰æœåŠ¡åŠ è½½"></a>è‡ªå®šä¹‰æœåŠ¡åŠ è½½</h4><p><img src="https://i.imgur.com/DW8LO8s.png" alt="image-20241031212647536"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// User_ServiceDesc is the grpc.ServiceDesc for User service.</span><br><span class="hljs-comment">// It&#x27;s only intended for direct use with grpc.RegisterService,</span><br><span class="hljs-comment">// and not to be introspected or modified (even as a copy)</span><br><span class="hljs-keyword">var</span> User_ServiceDesc = grpc.ServiceDesc&#123;<br>    ServiceName: <span class="hljs-string">&quot;user.User&quot;</span>,<br>    HandlerType: (*UserServer)(<span class="hljs-literal">nil</span>),<br>    Methods: []grpc.MethodDesc&#123;<br>       &#123;<br>          MethodName: <span class="hljs-string">&quot;GetUser&quot;</span>,<br>          Handler:    _User_GetUser_Handler,<br>       &#125;,<br>    &#125;,<br>    Streams:  []grpc.StreamDesc&#123;&#125;,<br>    Metadata: <span class="hljs-string">&quot;user.proto&quot;</span>,<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> _<span class="hljs-title">User_GetUser_Handler</span><span class="hljs-params">(srv <span class="hljs-keyword">interface</span>&#123;&#125;, ctx context.Context, dec <span class="hljs-keyword">func</span>(<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> <span class="hljs-type">error</span>, interceptor grpc.UnaryServerInterceptor) (<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-type">error</span>) &#123;<br>    in := <span class="hljs-built_in">new</span>(GetUserReq)<br>    <span class="hljs-keyword">if</span> err := dec(in); err != <span class="hljs-literal">nil</span> &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>    &#125;<br>    <span class="hljs-keyword">if</span> interceptor == <span class="hljs-literal">nil</span> &#123;<br>       <span class="hljs-keyword">return</span> srv.(UserServer).GetUser(ctx, in)<br>    &#125;<br>    info := &amp;grpc.UnaryServerInfo&#123;<br>       Server:     srv,<br>       FullMethod: User_GetUser_FullMethodName,<br>    &#125;<br>    handler := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, req <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> (<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-type">error</span>) &#123;<br>       <span class="hljs-keyword">return</span> srv.(UserServer).GetUser(ctx, req.(*GetUserReq))<br>    &#125;<br>    <span class="hljs-keyword">return</span> interceptor(ctx, in, info, handler)<br>&#125;<br><br><span class="hljs-comment">// RegisterService registers a service and its implementation to the gRPC</span><br><span class="hljs-comment">// server. It is called from the IDL generated code. This must be called before</span><br><span class="hljs-comment">// invoking Serve. If ss is non-nil (for legacy code), its type is checked to</span><br><span class="hljs-comment">// ensure it implements sd.HandlerType.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Server)</span></span> RegisterService(sd *ServiceDesc, ss any) &#123;<br>    <span class="hljs-keyword">if</span> ss != <span class="hljs-literal">nil</span> &#123;<br>       ht := reflect.TypeOf(sd.HandlerType).Elem()<br>       st := reflect.TypeOf(ss)<br>       <span class="hljs-keyword">if</span> !st.Implements(ht) &#123;<br>          logger.Fatalf(<span class="hljs-string">&quot;grpc: Server.RegisterService found the handler of type %v that does not satisfy %v&quot;</span>, st, ht)<br>       &#125;<br>    &#125;<br>    s.register(sd, ss)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Server)</span></span> register(sd *ServiceDesc, ss any) &#123;<br>    s.mu.Lock()<br>    <span class="hljs-keyword">defer</span> s.mu.Unlock()<br>    s.printf(<span class="hljs-string">&quot;RegisterService(%q)&quot;</span>, sd.ServiceName)<br>    <span class="hljs-keyword">if</span> s.serve &#123;<br>       logger.Fatalf(<span class="hljs-string">&quot;grpc: Server.RegisterService after Server.Serve for %q&quot;</span>, sd.ServiceName)<br>    &#125;<br>    <span class="hljs-keyword">if</span> _, ok := s.services[sd.ServiceName]; ok &#123;<br>       logger.Fatalf(<span class="hljs-string">&quot;grpc: Server.RegisterService found duplicate service registration for %q&quot;</span>, sd.ServiceName)<br>    &#125;<br>    info := &amp;serviceInfo&#123;<br>       serviceImpl: ss,<br>       methods:     <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*MethodDesc),<br>       streams:     <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*StreamDesc),<br>       mdata:       sd.Metadata,<br>    &#125;<br>    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> sd.Methods &#123;<br>       d := &amp;sd.Methods[i]<br>       info.methods[d.MethodName] = d<br>    &#125;<br>    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> sd.Streams &#123;<br>       d := &amp;sd.Streams[i]<br>       info.streams[d.StreamName] = d<br>    &#125;<br>    s.services[sd.ServiceName] = info<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æœåŠ¡åˆå§‹åŒ–"><a href="#æœåŠ¡åˆå§‹åŒ–" class="headerlink" title="æœåŠ¡åˆå§‹åŒ–"></a>æœåŠ¡åˆå§‹åŒ–</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs go">s := grpc.NewServer()<br><br><br><br><span class="hljs-comment">// NewServer creates a gRPC server which has no service registered and has not</span><br><span class="hljs-comment">// started to accept requests yet.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(opt ...ServerOption)</span></span> *Server &#123;<br>    opts := defaultServerOptions<br>    <span class="hljs-keyword">for</span> _, o := <span class="hljs-keyword">range</span> globalServerOptions &#123;<br>       o.apply(&amp;opts)<br>    &#125;<br>    <span class="hljs-keyword">for</span> _, o := <span class="hljs-keyword">range</span> opt &#123;<br>       o.apply(&amp;opts)<br>    &#125;<br>    s := &amp;Server&#123;<br>       lis:      <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[net.Listener]<span class="hljs-type">bool</span>),<br>       opts:     opts,<br>       conns:    <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">map</span>[transport.ServerTransport]<span class="hljs-type">bool</span>),<br>       services: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*serviceInfo),<br>       quit:     grpcsync.NewEvent(),<br>       done:     grpcsync.NewEvent(),<br>       channelz: channelz.RegisterServer(<span class="hljs-string">&quot;&quot;</span>),<br>    &#125;<br>    chainUnaryServerInterceptors(s)<br>    chainStreamServerInterceptors(s)<br>    s.cv = sync.NewCond(&amp;s.mu)<br>    <span class="hljs-keyword">if</span> EnableTracing &#123;<br>       _, file, line, _ := runtime.Caller(<span class="hljs-number">1</span>)<br>       s.events = newTraceEventLog(<span class="hljs-string">&quot;grpc.Server&quot;</span>, fmt.Sprintf(<span class="hljs-string">&quot;%s:%d&quot;</span>, file, line))<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> s.opts.numServerWorkers &gt; <span class="hljs-number">0</span> &#123;<br>       s.initServerWorkers()<br>    &#125;<br><br>    channelz.Info(logger, s.channelz, <span class="hljs-string">&quot;Server created&quot;</span>)<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;context&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;google.golang.org/grpc&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ErrInterceptor</span><span class="hljs-params">(ctx context.Context, req any, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler)</span></span> (resp any, err <span class="hljs-type">error</span>) &#123;<br>    fmt.Println(<span class="hljs-string">&quot;err begin&quot;</span>)<br>    resp, err = handler(ctx, req)<br>    fmt.Println(<span class="hljs-string">&quot;err end&quot;</span>)<br>    <span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    listener, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;:1234&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       log.Fatal(err)<br>    &#125;<br><br>    s := grpc.NewServer(grpc.ChainUnaryInterceptor(interceptor.LogInterceptor, interceptor.ErrInterceptor))<br>    user.RegisterUserServer(s, <span class="hljs-built_in">new</span>(UserService))<br>    log.Println(<span class="hljs-string">&quot;å¯åŠ¨æˆåŠŸ&quot;</span>)<br>    err = s.Serve(listener)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       log.Fatal(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è¯·æ±‚ç›‘å¬å¤„ç†"><a href="#è¯·æ±‚ç›‘å¬å¤„ç†" class="headerlink" title="è¯·æ±‚ç›‘å¬å¤„ç†"></a>è¯·æ±‚ç›‘å¬å¤„ç†</h4><p><img src="https://i.imgur.com/ImC3Tbc.png" alt="image-20241031212849420"></p><h3 id="go-zero"><a href="#go-zero" class="headerlink" title="go-zero"></a>go-zero</h3><blockquote><p>å¯¹ go-zeroçš„å®‰è£…ä¸åšèµ˜è¿°</p></blockquote><h4 id="å®è·µ-go-zero-åŸºç¡€åŠŸèƒ½æ¡ˆä¾‹ï¼ˆapi-rpcï¼‰"><a href="#å®è·µ-go-zero-åŸºç¡€åŠŸèƒ½æ¡ˆä¾‹ï¼ˆapi-rpcï¼‰" class="headerlink" title="å®è·µ go-zero åŸºç¡€åŠŸèƒ½æ¡ˆä¾‹ï¼ˆapi&#x2F;rpcï¼‰"></a>å®è·µ go-zero åŸºç¡€åŠŸèƒ½æ¡ˆä¾‹ï¼ˆapi&#x2F;rpcï¼‰</h4><ol><li><p>ç¼–å†™.protoæ–‡ä»¶</p></li><li><p>æ„å»º rpc æœåŠ¡</p></li><li><p>ç¼–å†™ api æ–‡ä»¶</p><ol><li><p>æ„å»º api æœåŠ¡</p><ol><li><p>æ„å»º rpc æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">goctl rpc new user<br></code></pre></td></tr></table></figure></li><li><p>æ„å»º api æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">goctl api new api<br></code></pre></td></tr></table></figure></li><li><p>ä¸€èˆ¬æƒ…å†µæ˜¯ç¼–å†™ <code>.api</code> æ–‡ä»¶å’Œç¼–å†™ <code>.proto</code>æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">      goctl rpc protoc user.proto --go_out=. --go-grpc_out=. --zrpc_out=.<br>      goctl api go -api user.api -<span class="hljs-built_in">dir</span> . -style gozero<br><br>2. æœåŠ¡è”è°ƒ<br><br>   ```yaml<br>   <span class="hljs-comment"># api etc user.yaml</span><br>   Name: User<br>   Host: 0.0.0.0<br>   Port: 8888<br>   <br>   UserRpc:<br>     Etcd:<br>       Hosts:<br>         - 117.50.179.8:2379<br>       Key: user.rpc<br>       User: <span class="hljs-string">&quot;root&quot;</span><br>       Pass: <span class="hljs-string">&quot;fghf987....&quot;</span><br></code></pre></td></tr></table></figure></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// internal config config.go</span><br><span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> &#123;<br>rest.RestConf<br><br>UserRpc zrpc.RpcClientConf<br>&#125;<br><br><br><span class="hljs-comment">// svc servicecontext.go</span><br><span class="hljs-keyword">type</span> ServiceContext <span class="hljs-keyword">struct</span> &#123;<br>Config     config.Config<br>UserClient userclient.User<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServiceContext</span><span class="hljs-params">(c config.Config)</span></span> *ServiceContext &#123;<br><span class="hljs-keyword">return</span> &amp;ServiceContext&#123;<br>Config:     c,<br>UserClient: userclient.NewUser(zrpc.MustNewClient(c.UserRpc)),<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// logic userlogic.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *UserLogic)</span></span> User(req *types.UserReq) (resp *types.UserResp, err <span class="hljs-type">error</span>) &#123;<br><span class="hljs-comment">// todo: add your logic here and delete this line</span><br>getUserResp, err := l.svcCtx.UserClient.GetUser(l.ctx, &amp;user.GetUserReq&#123;<br>Id: req.Id,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br><span class="hljs-keyword">return</span> &amp;types.UserResp&#123;<br>Id:    getUserResp.Id,<br>Name:  getUserResp.Name,<br>Phone: getUserResp.Phone,<br>&#125;, <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol></li></ol><h4 id="è¿æ¥æ•°æ®åº“"><a href="#è¿æ¥æ•°æ®åº“" class="headerlink" title="è¿æ¥æ•°æ®åº“"></a>è¿æ¥æ•°æ®åº“</h4><ol><li><p>ç¼–å†™ <em>.sql</em> æ–‡ä»¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `<span class="hljs-keyword">user</span>` (<br>                        `id` <span class="hljs-type">BIGINT</span> UNSIGNED AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;ç”¨æˆ·IDï¼Œä¸»é”®&#x27;</span>,<br>                        `username` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">UNIQUE</span> COMMENT <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>,<br>                        `email` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> COMMENT <span class="hljs-string">&#x27;ç”µå­é‚®ç®±&#x27;</span>,<br>                        `password` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰&#x27;</span>,<br>                        `phone` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">&#x27;æ‰‹æœºå·&#x27;</span>,<br>                        `status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;çŠ¶æ€ï¼š1=å¯ç”¨ï¼Œ0=ç¦ç”¨&#x27;</span>,<br>                        `created_at` <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>                        `updated_at` <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>                        <span class="hljs-keyword">PRIMARY KEY</span> (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ç”¨æˆ·è¡¨&#x27;</span>;<br></code></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆ model</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">goctl model mysql ddl --src user.sql --<span class="hljs-built_in">dir</span> <span class="hljs-string">&quot;./models/&quot;</span> -c<br></code></pre></td></tr></table></figure><p><code>-c</code>è¡¨ç¤ºä½¿ç”¨ç¼“å­˜</p></li></ol><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><h5 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h5><ul><li><p>core</p><p>å·¥å…·é›†åŒ…å«æ•°æ®å¤„ç†ã€ç†”æ–­å™¨ã€æœåŠ¡å‘ç°ç­‰å·¥å…·</p></li><li><p>internal</p><p>åŒ…å«æ¡†æ¶å¤„ç†ã€è¯·æ±‚ç¼–ç ã€å¥åº·æ£€æµ‹ç­‰åŠŸèƒ½</p></li><li><p>zrpc</p><p>æ˜¯rpcæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„æ ¸å¿ƒä»£ç </p></li></ul><h5 id="go-zero-å¦‚ä½•é€‚é…grpc"><a href="#go-zero-å¦‚ä½•é€‚é…grpc" class="headerlink" title="go-zero å¦‚ä½•é€‚é…grpc"></a>go-zero å¦‚ä½•é€‚é…grpc</h5><h5 id="æœåŠ¡å¦‚ä½•åˆå§‹åŒ–"><a href="#æœåŠ¡å¦‚ä½•åˆå§‹åŒ–" class="headerlink" title="æœåŠ¡å¦‚ä½•åˆå§‹åŒ–"></a>æœåŠ¡å¦‚ä½•åˆå§‹åŒ–</h5><h5 id="æœåŠ¡å¯åŠ¨"><a href="#æœåŠ¡å¯åŠ¨" class="headerlink" title="æœåŠ¡å¯åŠ¨"></a>æœåŠ¡å¯åŠ¨</h5>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
      <category>è¿›é˜¶è®­ç»ƒè¥</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿›é˜¶è®­ç»ƒè¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RPC</title>
    <link href="/2024/10/31/Golang/%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/RPC/"/>
    <url>/2024/10/31/Golang/%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/RPC/</url>
    
    <content type="html"><![CDATA[<h1 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h1><h2 id="golangä¸­çš„-RPC"><a href="#golangä¸­çš„-RPC" class="headerlink" title="golangä¸­çš„ RPC"></a>golangä¸­çš„ RPC</h2><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;errors&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;net&quot;</span><br>    <span class="hljs-string">&quot;net/rpc&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>    Id    <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;id,omitempty&quot;`</span><br>    Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name,omitempty&quot;`</span><br>    Phone <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;phone&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">var</span> users = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*User&#123;<br>    <span class="hljs-string">&quot;1&quot;</span>: &#123;<br>        Id:    <span class="hljs-string">&quot;1&quot;</span>,<br>        Name:  <span class="hljs-string">&quot;xx&quot;</span>,<br>        Phone: <span class="hljs-string">&quot;xx&quot;</span>,<br>    &#125;,<br>    <span class="hljs-string">&quot;2&quot;</span>: &#123;<br>        Id:    <span class="hljs-string">&quot;2&quot;</span>,<br>        Name:  <span class="hljs-string">&quot;xxx&quot;</span>,<br>        Phone: <span class="hljs-string">&quot;xxx&quot;</span>,<br>    &#125;,<br>&#125;<br><br><span class="hljs-keyword">type</span> (<br>    GetUserReq <span class="hljs-keyword">struct</span> &#123;<br>        Id <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;id&quot;`</span><br>    &#125;<br><br>    GetUserResp <span class="hljs-keyword">struct</span> &#123;<br>        Id    <span class="hljs-type">string</span><br>        Name  <span class="hljs-type">string</span><br>        Phone <span class="hljs-type">string</span><br>    &#125;<br>)<br><br><span class="hljs-keyword">type</span> UserServer <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *UserServer)</span></span> GetUser(req GetUserReq, resp *GetUserResp) <span class="hljs-type">error</span> &#123;<br>    <span class="hljs-keyword">if</span> u, ok := users[req.Id]; ok &#123;<br>        *resp = GetUserResp&#123;<br>            Id:    u.Id,<br>            Name:  u.Name,<br>            Phone: u.Phone,<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">&quot;æœªæ‰¾åˆ°ç”¨æˆ·&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    userServer := <span class="hljs-built_in">new</span>(UserServer)<br>    rpc.Register(userServer)<br>    listener, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;:1234&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Println(<span class="hljs-string">&quot;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ&quot;</span>)<br>    <span class="hljs-keyword">for</span> &#123;<br>        conn, err := listener.Accept()<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            log.Println(<span class="hljs-string">&quot;ç›‘å¬å®¢æˆ·ç«¯è¿æ¥å¤±è´¥&quot;</span>)<br>            <span class="hljs-keyword">continue</span><br>        &#125;<br>        <span class="hljs-keyword">go</span> rpc.ServeConn(conn)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;net/rpc&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> (<br>    GetUserReq <span class="hljs-keyword">struct</span> &#123;<br>        Id <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;id&quot;`</span><br>    &#125;<br><br>    GetUserResp <span class="hljs-keyword">struct</span> &#123;<br>        Id    <span class="hljs-type">string</span><br>        Name  <span class="hljs-type">string</span><br>        Phone <span class="hljs-type">string</span><br>    &#125;<br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    client, err := rpc.Dial(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;localhost:1234&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> client.Close()<br>    <span class="hljs-keyword">var</span> (<br>        req = GetUserReq&#123;<br>            Id: <span class="hljs-string">&quot;3&quot;</span>,<br>        &#125;<br>        res GetUserResp<br>    )<br>    err = client.Call(<span class="hljs-string">&quot;UserServer.GetUser&quot;</span>, req, &amp;res)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(<span class="hljs-string">&quot;è¯·æ±‚å¼‚å¸¸&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    log.Println(res)<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="æ€ä¹ˆåˆ†æè¿™ä¸€å—çš„æºç ï¼Ÿ"><a href="#æ€ä¹ˆåˆ†æè¿™ä¸€å—çš„æºç ï¼Ÿ" class="headerlink" title="æ€ä¹ˆåˆ†æè¿™ä¸€å—çš„æºç ï¼Ÿ"></a>æ€ä¹ˆåˆ†æè¿™ä¸€å—çš„æºç ï¼Ÿ</h3><blockquote><p>æºç åˆ†æä¸‰æ­¥</p></blockquote><ol><li><p>ç›®çš„</p><ol><li>å®¢æˆ·ç«¯ä¸ºå•¥èƒ½ç›´æ¥è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•</li><li>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„äº¤äº’çš„æ•°æ®æ ¼å¼ç¡®å®š</li></ol></li><li><p>æ„æ€å®ç°ï¼š</p><ol><li><p>Rpc ä¹‹é—´é€šè®¯çš„æ•°æ®æ ¼å¼ä¸ä¼ è¾“å‚æ•°</p></li><li><p>Rpc ä¹‹é—´çš„çš„é€šè®¯æ•°æ®æ ¼å¼ä¸ä¼ è¾“å‚æ•°</p><p>æ ‡å‡†åº“æ˜¯é€šè¿‡ json å®ç°çš„ï¼Œéœ€è¦è€ƒè™‘å…¶ä»–ç±»å‹è½¬æ¢æƒ…å†µ</p></li><li><p>æ¥å—åˆ°è¯·æ±‚æ¶ˆæ¯ä¹‹åæ˜¯å¦‚ä½•è¿è¡Œå¯¹åº”æœåŠ¡çš„</p><p>â€‹    <img src="https://i.imgur.com/PTGAkaq.png" alt="image-20241031203029336"></p></li></ol></li><li><p>ç›´æ¥é˜…è¯»æºç </p></li></ol><h3 id="å­˜åœ¨çš„é—®é¢˜ï¼Ÿ"><a href="#å­˜åœ¨çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜ï¼Ÿ"></a>å­˜åœ¨çš„é—®é¢˜ï¼Ÿ</h3><p><img src="https://i.imgur.com/cE6mxPs.png" alt="image-20241031203127867"></p>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
      <category>è¿›é˜¶è®­ç»ƒè¥</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿›é˜¶è®­ç»ƒè¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®æœåŠ¡æ¶æ„</title>
    <link href="/2024/07/12/Golang/%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    <url>/2024/07/12/Golang/%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h1 id="å¾®æœåŠ¡æ¶æ„"><a href="#å¾®æœåŠ¡æ¶æ„" class="headerlink" title="å¾®æœåŠ¡æ¶æ„"></a>å¾®æœåŠ¡æ¶æ„</h1><h2 id="å¾®æœåŠ¡æ¶æ„æ•´ä½“æ„Ÿå—"><a href="#å¾®æœåŠ¡æ¶æ„æ•´ä½“æ„Ÿå—" class="headerlink" title="å¾®æœåŠ¡æ¶æ„æ•´ä½“æ„Ÿå—"></a>å¾®æœåŠ¡æ¶æ„æ•´ä½“æ„Ÿå—</h2><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ol><li>ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ï¼Ÿ</li><li>æœåŠ¡åº”è¯¥å¦‚ä½•æ‹†åˆ†ï¼Ÿ</li><li>å¾®æœåŠ¡æ¶æ„å¸¦æ¥äº†å“ªäº›é—®é¢˜ï¼Ÿä»¥åŠå¦‚ä½•å»è§£å†³è¿™äº›é—®é¢˜ã€‚</li></ol><h3 id="å…¸å‹æ¶æ„å›¾"><a href="#å…¸å‹æ¶æ„å›¾" class="headerlink" title="å…¸å‹æ¶æ„å›¾"></a>å…¸å‹æ¶æ„å›¾</h3><p><img src="https://i.imgur.com/JXw7vLg.png" alt="image-20240710222819833"></p><p>å¾®æœåŠ¡æ¶æ„çŸ¥è¯†å†…å®¹ï¼š</p><ol><li>åº”ç”¨ç”±å¤šä¸ªæœåŠ¡æ„æˆã€‚</li><li>æœåŠ¡ç‹¬äº«è‡ªèº«æ•°æ®ã€‚</li><li>æœåŠ¡ä¼šå…±äº«é…ç½®ï¼Œä½¿ç”¨é…ç½®ä¸­å¿ƒæ¥æ”¯æŒã€‚</li><li>æœåŠ¡è¿˜ä¼šå…±äº«ä¸­é—´ä»¶ï¼Œä¸»è¦ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æœç´¢ã€æ—¥å¿—ç­‰ã€‚</li><li>æœåŠ¡é—´éœ€è¦é€šä¿¡ï¼Œç¬¬ä¸€æ­¥éœ€è¦æ‰¾åˆ°ç›®æ ‡æœåŠ¡ã€‚éœ€è¦æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚</li><li>æœåŠ¡éœ€è¦é€šä¿¡ï¼Œè§„èŒƒé€šä¿¡åè®®ï¼Œå…¸å‹çš„åè®®ï¼šgRPCï¼ŒRestFul APIï¼ŒHTTPã€MQã€‚</li><li>åº”ç”¨è¦å“åº”å¤–éƒ¨çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘ç»™ç›®æ ‡æœåŠ¡ã€‚éœ€è¦ API ç½‘å…³æŠ€æœ¯ã€‚</li><li>æœåŠ¡è¯·æ±‚éœ€è¦è¢«æ§åˆ¶çš„ç®¡ç†ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡ã€é™æµã€ç†”æ–­ã€é™çº§ç­‰æ§åˆ¶ã€‚</li><li>æœåŠ¡é—´æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œé€šå¸¸éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ã€åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼ Sessionã€‚</li><li>æœåŠ¡éœ€è¦è¢«ç›‘æ§ã€éœ€è¦é“¾è·¯è¿½è¸ªã€ç›‘æ§å¹³å°ã€æ—¥å¿—åˆ†æã€‚</li></ol><h3 id="çœ‹å‰é¡»çŸ¥"><a href="#çœ‹å‰é¡»çŸ¥" class="headerlink" title="çœ‹å‰é¡»çŸ¥"></a>çœ‹å‰é¡»çŸ¥</h3><ol><li>Go æ ¸å¿ƒè¯­æ³•ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ go ç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€‚</li><li>Linux åŸºç¡€æ“ä½œï¼Œéœ€è¦çš„ç¨‹åºè½¯ä»¶å¤§éƒ½å®‰è£…åœ¨ linux ä¸Šã€‚</li><li>Web ç›¸å…³ç¼–ç¨‹æŠ€æœ¯ï¼Œéœ€è¦ä½¿ç”¨ http è¯·æ±‚å“åº”ç›¸å…³æ“ä½œã€‚</li></ol><h2 id="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„"><a href="#ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„" class="headerlink" title="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„"></a>ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„</h2><h3 id="å·¨çŸ³æ¶æ„"><a href="#å·¨çŸ³æ¶æ„" class="headerlink" title="å·¨çŸ³æ¶æ„"></a>å·¨çŸ³æ¶æ„</h3><p>æ—©æœŸï¼Œå¤§éƒ¨åˆ†çš„åº”ç”¨ç¨‹åºæ˜¯å°†å…¨éƒ¨çš„åŠŸèƒ½æ¨¡å—ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæ‰“åŒ…ã€å‘å¸ƒã€è¿è¡Œã€‚è¿™æ ·ç¨‹åºä¼šè¶Šæ¥è¶Šå¤§ï¼Œåƒä¸€å—å¤§çŸ³å¤´ä¸€æ ·ï¼Œå› æ­¤ç§°ä¸ºå·¨çŸ³æ¶æ„ï¼ˆthe monolithic architectureï¼‰ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå•†åŸç³»ç»Ÿå¯èƒ½åŒ…å«ï¼šåˆ†ç±»ã€å•†å“ã€è´­ç‰©è½¦ã€è®¢å•ã€æ”¯ä»˜ã€ç‰©æµã€è¯„ä»·ã€å”®åã€ä¼šå‘˜ã€æ¨å¹¿ã€å•†æˆ·ç­‰åŠŸèƒ½æ¨¡å—ã€‚é‚£ä¹ˆç¨‹åºçš„æ¶æ„å°±æ˜¯ï¼š</p><p><img src="https://i.imgur.com/6GYGacV.png" alt="image-20240710223242786"></p><p>å·¨çŸ³åº”ç”¨çš„åŠ£åŠ¿ï¼š</p><ul><li>æ›´æ–°å±€éƒ¨ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²æ•´ä½“</li><li>æ•´ä½“å‘å¸ƒæ—¶é—´è¿‡é•¿ï¼ŒåŒ…æ‹¬ç¼–è¯‘ã€å‘å¸ƒç­‰</li><li>å›å½’æµ‹è¯•å‘¨æœŸè¿‡é•¿</li><li>ä¸åˆ©äºæ–°æŠ€æœ¯åº”ç”¨ï¼Œå¦åˆ™éœ€è¦é‡æ„æ•´ä½“åº”ç”¨</li></ul><p>å·¨çŸ³åº”ç”¨ä¹Ÿæœ‰è‡ªå·±çš„ä¼˜åŠ¿ï¼Œä¾‹å¦‚éƒ¨ç½²å®¹æ˜“ï¼Œæ•´ä½“æ‰“åŒ…ï¼Œæ•´ä½“éƒ¨ç½²å³å¯ï¼›IDE å‹å¥½ï¼Œæµ‹è¯•å®¹æ˜“ã€ç›‘æ§æ–¹ä¾¿ã€‚</p><h3 id="å¾®æœåŠ¡æ¶æ„-1"><a href="#å¾®æœåŠ¡æ¶æ„-1" class="headerlink" title="å¾®æœåŠ¡æ¶æ„"></a>å¾®æœåŠ¡æ¶æ„</h3><p>å¾®æœåŠ¡æ¶æ„ï¼ˆMicroServices Architecture Patternï¼‰çš„ç›®çš„æ˜¯å°†å¤§å‹çš„ã€å¤æ‚çš„ã€é•¿æœŸè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼ˆå·¨çŸ³åº”ç”¨ï¼‰æ„å»ºä¸ºä¸€ç»„ç›¸äº’é…åˆçš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥å¾ˆå®¹æ˜“å¾—å±€éƒ¨æ”¹è‰¯ã€‚<strong>Micro</strong> æ„å‘³ç€æœåŠ¡åº”è¯¥è¶³å¤Ÿå°ï¼ŒæœåŠ¡çš„å¤§å°åº”è¯¥ä»ä¸šåŠ¡é€»è¾‘ä¸Šè¡¡é‡ï¼Œè€Œä¸æ˜¯ç”¨ä»£ç é‡ã€‚ç¬¦åˆ SRP ï¼ˆå•ä¸€èŒè´£åŸåˆ™ï¼‰çš„æ‰å«å¾®æœåŠ¡ã€‚</p><p>å¾®æœåŠ¡æ˜¯å»ä¸­å¿ƒåŒ–çš„åˆ†å¸ƒå¼è½¯ä»¶æ¶æ„ã€‚å¾®æœåŠ¡é€šå¸¸æ˜¯æ— çŠ¶æ€æœåŠ¡ã€‚</p><p>å¾®æœåŠ¡æ¶æ„çš„ä¼˜åŠ¿ï¼š</p><ul><li>æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒæŠ€æœ¯æ ˆç ”å‘</li><li>æ¯ä¸ªå¾®æœåŠ¡éƒ½å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–ï¼Œéƒ¨ç½²æˆ–æ‰©å±•</li><li>æ›´å¥½çš„æ•…éšœå¤„ç†å’Œé”™è¯¯æ£€æµ‹</li><li>æœåŠ¡å¤ç”¨æ€§å¼º</li><li>æœåŠ¡æ‰©å±•æ€§å¼º</li></ul><p>å•ä½“åº”ç”¨æ‹†è§£æˆå¤§é‡çš„å¾®æœåŠ¡ï¼Œå¸¦æ¥çš„æ–°é—®é¢˜æ˜¯æœåŠ¡é—´é€šä¿¡å’Œä¸€è‡´æ€§ç­‰é—®é¢˜ï¼Œé€šå¸¸éœ€è¦é€šè¿‡æœåŠ¡æ³¨å†Œå‘ç°ã€æœåŠ¡ç½‘æ ¼ã€åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼äº‹åŠ¡æ¥è§£å†³ã€‚</p><p>ä¸Šé¢çš„åº”ç”¨ï¼Œæ‹†åˆ†ä¹‹åï¼š</p><p><img src="https://i.imgur.com/84ZJjjR.png" alt="image-20240710223419599"></p><h3 id="SOA-ä¸æœåŠ¡"><a href="#SOA-ä¸æœåŠ¡" class="headerlink" title="SOA ä¸æœåŠ¡"></a>SOA ä¸æœåŠ¡</h3><p>SOAï¼ˆService-Oriented Architectureï¼Œé¢å‘æœåŠ¡çš„æ¶æ„ï¼‰æ˜¯ä¸€ç§åœ¨è®¡ç®—æœºç¯å¢ƒä¸­è®¾è®¡ã€å¼€å‘ã€éƒ¨ç½²å’Œç®¡ç†ç¦»æ•£æ¨¡å‹çš„æ–¹æ³•ã€‚åœ¨ SOA æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰çš„åŠŸèƒ½éƒ½è¢«å®šä¹‰æˆäº†ç‹¬ç«‹çš„æœåŠ¡ï¼Œæ‰€æœ‰çš„æœåŠ¡é€šè¿‡ä¼ä¸šæœåŠ¡æ€»çº¿(ESB, Enterprise Service Bus)æˆ–æµç¨‹ç®¡ç†å™¨æ¥è¿æ¥ã€‚</p><p>å¸¦æœ‰ ESB çš„æ¶æ„å…¸å‹å¦‚ä¸‹ï¼š</p><p><img src="https://i.imgur.com/8K6F5ei.png" alt="image-20240710223558517"></p><p>å¾®æœåŠ¡æ¶æ„ä¸ SOA æ¶æ„æœ€é‡è¦çš„åŒºåˆ«æ˜¯ï¼š</p><ul><li>å¾®æœåŠ¡æ¶æ„æ˜¯å»ä¸­å¿ƒåŒ–çš„åˆ†å¸ƒå¼æ¶æ„</li><li>SOA æ˜¯ä¸­å¿ƒåŒ–çš„åˆ†å¸ƒå¼æ¶æ„ã€‚</li></ul><h3 id="äº‘åŸç”Ÿä¸­çš„å¾®æœåŠ¡"><a href="#äº‘åŸç”Ÿä¸­çš„å¾®æœåŠ¡" class="headerlink" title="äº‘åŸç”Ÿä¸­çš„å¾®æœåŠ¡"></a>äº‘åŸç”Ÿä¸­çš„å¾®æœåŠ¡</h3><p>å¾®æœåŠ¡æ˜¯äº‘åŸç”ŸæŠ€æœ¯çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸Šè¿è¡Œçš„ç°ä»£äº‘åŸç”Ÿåº”ç”¨ç¨‹åºä¾èµ–äºä»¥ä¸‹å…³é”®ç»„ä»¶ï¼š</p><ul><li>å®¹å™¨åŒ–ï¼Œé€šè¿‡å°†æœåŠ¡åˆ†æˆå¤šä¸ªè¿›ç¨‹æ¥è¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†å’Œéƒ¨ç½²ï¼Œä¾‹å¦‚ Docker ç±»å¹³å°ã€‚</li><li>ç¼–æ’ï¼Œç”¨äºé…ç½®ã€åˆ†é…å’Œç®¡ç†æœåŠ¡çš„å¯ç”¨ç³»ç»Ÿèµ„æºï¼Œä¾‹å¦‚ Kubernetes ç±»å¹³å°ã€‚</li><li>æœåŠ¡ç½‘æ ¼ï¼Œé€šè¿‡æœåŠ¡ä»£ç†ç½‘æ ¼è¿›è¡ŒæœåŠ¡é—´é€šä¿¡ï¼Œè¿æ¥ï¼Œç®¡ç†å’Œä¿æŠ¤å¾®æœåŠ¡ï¼Œä¾‹å¦‚ Istio ç±»å¹³å°ã€‚</li></ul><p>ä»¥ä¸Šä¸‰ä¸ªæ˜¯å¾®æœåŠ¡æ¶æ„åœ¨äº‘åŸç”Ÿä¸­æœ€é‡è¦çš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å…è®¸äº‘åŸç”Ÿä¸­çš„åº”ç”¨ç¨‹åºåœ¨è´Ÿè½½ä¸‹æ‰©å±•ï¼Œç”šè‡³åœ¨æ•…éšœæœŸé—´ä¹Ÿèƒ½æ‰§è¡Œã€‚</p><h2 id="æ‹†åˆ†åŸåˆ™"><a href="#æ‹†åˆ†åŸåˆ™" class="headerlink" title="æ‹†åˆ†åŸåˆ™"></a>æ‹†åˆ†åŸåˆ™</h2><p>å¾®æœåŠ¡æ˜¯åŒ–æ•´ä¸ºé›¶ã€åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ã€‚</p><p>æ‹†åˆ†åŸåˆ™ä¸€è§ˆï¼š</p><p><strong>ä¸šåŠ¡æ‹†åˆ†ï¼š</strong></p><p>ä¸šåŠ¡é€»è¾‘æ‹†åˆ†ï¼Œå•ä¸€èŒè´£ï¼ŒæœåŠ¡è‡ªèº«å¯æ²»ç†æ•°æ®åº“ã€‚</p><p>ç‹¬ç«‹åŠŸèƒ½ç”¨ä¾‹æ‹†åˆ†ï¼Œç‹¬ç«‹çš„äºŒæ–¹æˆ–ä¸‰æ–¹ç”¨ä¾‹ï¼Œé€šå¸¸æ‹†åˆ†ä¸ºç‹¬ç«‹æœåŠ¡ã€‚ä¾‹å¦‚äºŒæ–¹çš„è´¦å·æœåŠ¡å’Œä¸‰æ–¹çš„æ”¯ä»˜æœåŠ¡ã€‚</p><p><strong>æŠ€æœ¯æ‹†åˆ†ï¼š</strong></p><p>æœåŠ¡çš„å¹¶å‘æ€§ï¼Œè€ƒè™‘æŒç»­å¹¶å‘ã€ç¬æ—¶å¹¶å‘ï¼Œæ‹†åˆ†æœåŠ¡ç‹¬ç«‹ã€‚</p><p>æœåŠ¡å¤„ç†çš„æ•°æ®ï¼Œè€ƒè™‘æ•°æ®é‡ã€è¯»å†™æ“ä½œçš„æ•°æ®ã€å†·çƒ­æ•°æ®é‡ã€è¾¹é•¿å®šé•¿æ•°æ®ç±»å‹ï¼Œå°†æœåŠ¡æ‹†åˆ†ã€‚</p><p>æœåŠ¡çš„å®‰å…¨ç­‰çº§ï¼Œè€ƒè™‘æœåŠ¡ä¸šåŠ¡ã€æ•°æ®çš„å®‰å…¨ç­‰çº§ã€é‡‡ç”¨ä¸åŒçš„å®‰å…¨ç­–ç•¥ï¼Œæ¥è¿›è¡Œæ‹†åˆ†ã€‚</p><p>æœåŠ¡éœ€è¦çš„èµ„æºï¼Œè€ƒè™‘æœåŠ¡éœ€è¦è®¡ç®—ã€I&#x2F;Oã€ç½‘ç»œã€å­˜å‚¨ç­‰èµ„æºã€æ¥è¿›è¡Œæ‹†åˆ†ã€‚</p><p>æœåŠ¡æ‰©å±•æ€§ï¼Œè€ƒè™‘æœåŠ¡ä¸­æŠ€æœ¯ã€ä¸šåŠ¡ç­‰çš„æ›´æ–°ç‡ã€æ‰©å±•ç‡ï¼Œè¿›è¡Œæ‹†åˆ†ã€‚</p><p>æ¶æ„çš„ç¨³å®šæ€§ï¼Œè€ƒè™‘å•ä½“æœåŠ¡çš„æŠ€æœ¯æ¶æ„ç¨³å®šæ€§ã€‚</p><p>ä¾¿äºæµ‹è¯•ï¼Œæµ‹è¯•å¯é›†æˆã€å¯å›æº¯ã€‚</p><p>ä¾¿äºç›‘æ§ï¼Œä¾¿äºæ—¥å¿—åˆ†æã€æŒ‡æ ‡ç›‘æ§ç­‰ã€‚</p><p><strong>é¡¹ç›®æ‹†åˆ†ï¼š</strong></p><p>å›¢é˜Ÿï¼ˆå¼€å‘ã€æµ‹è¯•ã€è¿ç»´ï¼‰å°è€Œç¾ã€‚å°æŒ‡çš„æ˜¯è§„æ¨¡ï¼Œå›¢é˜Ÿé€šå¸¸ 10 äººå·¦å³ï¼›ç¾æŒ‡çš„æ˜¯å›¢é˜Ÿå¯è‡ªæ²»ï¼Œä¸å…¶ä»–å›¢é˜Ÿäººå‘˜åè°ƒå°½é‡å°‘ã€‚</p><p>æˆæœ¬å› ç´ ï¼Œè€ƒè™‘æŠ€æœ¯ï¼ˆå­¦ä¹ ï¼‰æˆæœ¬ã€äººåŠ›æˆæœ¬ã€æ—¶é—´æˆæœ¬ã€è®¾æ–½æˆæœ¬ï¼Œæ¥æ‹†åˆ†æœåŠ¡ã€‚</p><h3 id="AKF-æ‰©å±•ç«‹æ–¹ä½“"><a href="#AKF-æ‰©å±•ç«‹æ–¹ä½“" class="headerlink" title="AKF æ‰©å±•ç«‹æ–¹ä½“"></a>AKF æ‰©å±•ç«‹æ–¹ä½“</h3><p>ç«‹æ–¹ä½“å›¾ï¼š</p><p><img src="https://i.imgur.com/VWvqOOl.png" alt="image-20240711113639989"></p><h4 id="X-è½´ï¼Œå…‹éš†æ‰©å±•ï¼ˆæ°´å¹³å¤åˆ¶ï¼‰"><a href="#X-è½´ï¼Œå…‹éš†æ‰©å±•ï¼ˆæ°´å¹³å¤åˆ¶ï¼‰" class="headerlink" title="X è½´ï¼Œå…‹éš†æ‰©å±•ï¼ˆæ°´å¹³å¤åˆ¶ï¼‰"></a>X è½´ï¼Œå…‹éš†æ‰©å±•ï¼ˆæ°´å¹³å¤åˆ¶ï¼‰</h4><p>Xè½´ï¼Œä»£è¡¨æ— å·®åˆ«æœåŠ¡å’Œæ•°æ®çš„å…‹éš†ï¼Œä¹Ÿç§°æ°´å¹³æ‰©å±•ã€‚å®ƒæŒ‡çš„æ˜¯ï¼Œç›¸åŒçš„æœåŠ¡éƒ¨ç½²å¤šä¸ªï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡å™¨åœ¨å¤šä¸ªåº”ç”¨é—´åšé€‰æ‹©ã€‚</p><p>å›¾ä¾‹ï¼š</p><p><img src="https://i.imgur.com/98Xf4y3.png" alt="image-20240711113729258"></p><h4 id="Y-è½´ï¼ŒåŠŸèƒ½æ‹†åˆ†æ‰©å±•"><a href="#Y-è½´ï¼ŒåŠŸèƒ½æ‹†åˆ†æ‰©å±•" class="headerlink" title="Y è½´ï¼ŒåŠŸèƒ½æ‹†åˆ†æ‰©å±•"></a>Y è½´ï¼ŒåŠŸèƒ½æ‹†åˆ†æ‰©å±•</h4><p>Yè½´ï¼Œä»£è¡¨ä¾æ®èµ„æºã€æœåŠ¡æˆ–åŠŸèƒ½è¿›è¡Œæ‹†åˆ†ã€‚æŒ‡çš„æ˜¯æŠŠä»»ä½•ç‰¹å®šåŠŸèƒ½çš„æ“ä½œä»¥åŠæ“ä½œæ‰€éœ€çš„æ•°æ®èµ„æºä»æ•´ä½“ï¼ˆæˆ–å…¶ä»–æ“ä½œï¼‰ä¸­åˆ†ç¦»å‡ºæ¥ã€‚X è½´ä½“ç°çš„æ˜¯ç›¸åŒåŠŸèƒ½çš„å¤åˆ¶ï¼Œè€Œ Y è½´ä½“ç°çš„æ˜¯å¤šä¸ªä¸åŒåŠŸèƒ½çš„ç»„åˆã€‚</p><p>å¦‚å›¾ï¼šç”¨æˆ·è´­ä¹°å•†å“ï¼Œéœ€è¦æµè§ˆå•†å“ä¿¡æ¯ã€è´­ä¹°ã€è®¢å•ç®¡ç†ã€æ”¯ä»˜ç­‰æ“ä½œï¼Œä¾æ®åŠŸèƒ½å°†åº”ç”¨æ‹†åˆ†ä¸ºï¼š</p><p><img src="https://i.imgur.com/lyE8H0n.png" alt="image-20240711113804383"></p><p>è¿™ç§æ‹†åˆ†ï¼Œå°±æ˜¯å…¸å‹å¾®æœåŠ¡æ¶æ„ä¸­ä¸šåŠ¡é€»è¾‘çš„æ‹†åˆ†æ–¹æ¡ˆï¼Œæ¯ä¸ªæœåŠ¡è´Ÿè´£å…·ä½“çš„æŸä¸ªç‰¹å®šåŠŸèƒ½ï¼Œæ•´ä½“åº”ç”¨ç”±å¤šä¸ªæœåŠ¡ç»„æˆã€‚</p><p>åŒæ ·ï¼Œè‹¥æŸä¸ªæœåŠ¡éœ€è¦æ›´å¤šçš„èµ„æºï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ X è½´æ‰©å±•æ¨¡å¼ï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­çš„è®¢å•æœåŠ¡ã€‚</p><h4 id="Z-è½´ï¼Œæ•°æ®æ‹†åˆ†æ‰©å±•"><a href="#Z-è½´ï¼Œæ•°æ®æ‹†åˆ†æ‰©å±•" class="headerlink" title="Z è½´ï¼Œæ•°æ®æ‹†åˆ†æ‰©å±•"></a>Z è½´ï¼Œæ•°æ®æ‹†åˆ†æ‰©å±•</h4><p>å½“ä¸šåŠ¡åŸºäº Xã€Y åšäº†å…‹éš†æˆ–æ‹†åˆ†åï¼Œæ•°æ®å­˜å‚¨çš„å‹åŠ›éœ€è¦é€šè¿‡ Z è½´æ‰©å±•è§£å†³ã€‚Z è½´æ‰©å±•é€šå¸¸æŒ‡çš„æ˜¯æ•°æ®åº“æ‹†åˆ†ã€‚æ•°æ®åº“æ‹†åˆ†å¦‚ä¾æ®åœ°åŸŸåˆ’åˆ†ã€ä¾æ®ä¸åŒåŠŸèƒ½çš„è¡¨åˆ’åˆ†æˆ–å°†è¡¨ä¸­çš„è®°å½•ä¾æ®ä¸»é”®hashï¼ˆæˆ–å…¶ä»–åˆ†åŒºç®—æ³•ï¼‰åˆ’åˆ†ç­‰ã€‚</p><p>åœ°åŸŸï¼š</p><p><img src="https://i.imgur.com/njoLZmv.png" alt="image-20240711113907153"></p><p>åŸºäºåŠŸèƒ½ï¼š</p><p><img src="https://i.imgur.com/7XsuXnX.png" alt="image-20240711113957121"></p><p>è®°å½•åˆ’åˆ†ï¼š</p><p><img src="https://i.imgur.com/j1C2q2p.png" alt="image-20240711114009105"></p><h4 id="åŸç‚¹"><a href="#åŸç‚¹" class="headerlink" title="åŸç‚¹"></a>åŸç‚¹</h4><p>åæ ‡åŸç‚¹ (0, 0, 0) è¡¨ç¤ºåº”ç”¨ç³»ç»Ÿçš„æœ€å°æ‰©å±•æ€§ã€‚</p><h3 id="SRP-å•ä¸€èŒè´£åŸåˆ™"><a href="#SRP-å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="SRP å•ä¸€èŒè´£åŸåˆ™"></a>SRP å•ä¸€èŒè´£åŸåˆ™</h3><p>å•ä¸€èŒè´£åŸåˆ™ï¼Œåº”è¯¥è¡¨è¾¾æœ€æœ´ç´ çš„ä¸€ä¸ªåŸåˆ™äº†ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªæœåŠ¡è´Ÿè´£å•ç‹¬çš„ä¸€ä¸ªèŒè´£ï¼Œå°±æ„å‘³ç€æˆ‘ä»¬çš„è®¾è®¡æ»¡è¶³å•ä¸€èŒè´£ã€‚</p><p>SRPï¼ŒSingle Responsibility Principleï¼Œå•ä¸€èŒè´£åŸåˆ™æ¥è‡ªäºé¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ï¼Œæ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p><blockquote><p>There should never be more than one reason for a class to change.</p></blockquote><p>æ˜ å°„åˆ°æˆ‘ä»¬å¾®æœåŠ¡å…¶å®å°±æ˜¯ï¼šå¯¹äºæœåŠ¡è€Œè¨€ï¼Œåº”è¯¥åªæœ‰ä¸€ä¸ªç†ç”±å¼•èµ·å®ƒçš„å˜åŒ–ã€‚</p><p>ä¹Ÿå°±æ˜¯ï¼Œä¸€ä¸ªæœåŠ¡çš„åŠŸèƒ½è¦å•ä¸€ï¼Œåªåšä¸ä¹‹ç›¸å…³çš„äº‹æƒ…ï¼Œåœ¨æœåŠ¡çš„è®¾è®¡è¿‡ç¨‹ä¸­è¦æŒ‰ç…§èŒè´£è¿›è¡Œè®¾è®¡ã€‚å¦‚æœéœ€è¦æ›´å¤šåŠŸèƒ½å‘¢ï¼Œé‚£ä¹ˆå°±éœ€è¦æ›´å¤šçš„æœåŠ¡ï¼ŒæœåŠ¡å½¼æ­¤äº’ä¸å¹²æ¶‰ã€‚</p><p>å•ä¸€èŒè´£åŸåˆ™åœ¨ä½¿ç”¨æ—¶ï¼Œè¦æ³¨æ„ç²’åº¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åº”è¯¥å°†å•ä½“æœåŠ¡çš„è§„æ¨¡è®¾è®¡å¤šå¤§ã€‚å¦‚æœç²’åº¦è¿‡ç»†ï¼Œä¼šå¯¼è‡´åœ¨å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ä¸Šéƒ½ä¼šå¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ã€‚åŒæ ·è‹¥ç²’åº¦è¿‡ç²—ï¼Œé‚£ä¹ˆç‰¹å®šåŠŸèƒ½çš„æ›´æ–°ï¼Œç›´æ¥ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡æ›´æ–°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‹†åˆ†æœåŠ¡æ—¶ï¼Œé™¤äº†è¦è€ƒè™‘åŠŸèƒ½æ€§ï¼Œè¿˜è¦è€ƒè™‘å’Œé¢„æµ‹éœ€æ±‚çš„å˜åŒ–ç‚¹ã€å˜åŒ–ç‡ï¼Œä»¥åŠæ•°æ®å¢é•¿ç‚¹ã€å¹¶å‘çƒ­ç‚¹ç­‰ï¼Œç›¸äº’ç»“åˆï¼Œè®¾è®¡å‡ºç›¸å¯¹å¹³è¡¡çš„ç‹¬ç«‹æœåŠ¡ã€‚</p><p>ä¾‹å¦‚ï¼Œå¯¹äºå•†å“æœåŠ¡ï¼Œå•†å“çš„å“ç‰Œã€æ ‡ç­¾ã€å±æ€§ã€åº“å­˜ç­‰ï¼Œæ˜¯å¦éœ€è¦ç‹¬ç«‹è®¾è®¡ä¸ºä¸€ä¸ªæœåŠ¡å‘¢ï¼Ÿè¿™ä¸ªéœ€è¦åŸºäºæˆ‘ä»¬è‡ªèº«çš„ä¸šåŠ¡é€»è¾‘è¿›è¡Œè®¾è®¡ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œåº“å­˜é€šå¸¸éœ€è¦ç‹¬ç«‹æœåŠ¡è®¾è®¡çš„ï¼Œå› ä¸ºåº“å­˜åœ¨è®¢å•ç”Ÿæˆå’Œä»“åº“ç®¡ç†æ—¶ï¼Œä¼šè¢«é«˜é¢‘ç‡ä½¿ç”¨ã€‚è€Œå…¶ä»–åŠŸèƒ½ï¼Œé€šå¸¸éš¶å±äºå•†å“æœåŠ¡çš„èŒƒç•´ã€‚</p><p>SRP åŸåˆ™é€šå¸¸ä¹Ÿä¼šè¢«è¡¨è¿°ä¸ºæœåŠ¡è®¾è®¡çš„é«˜å†…èšä½è€¦åˆã€‚å†…èšåº¦æ˜¯ä»åŠŸèƒ½è§’åº¦æ¥åº¦é‡æ¨¡å—å†…çš„è”ç³»ï¼Œä¸€ä¸ªå¥½çš„å†…èšæ¨¡å—åº”å½“æ°å¥½åªåšä¸€ä»¶äº‹ï¼Œé«˜å†…èšå°±æ˜¯ä¸€ä¸ªç±»å°è£…çš„å¾ˆå®Œå–„ï¼Œæ¯ä¸ªç±»åªå®Œæˆä¸€é¡¹ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„å•ä¸€è´£ä»»åŸåˆ™ã€‚   è€¦åˆåº¦æ˜¯å¯¹æ¨¡å—é—´å…³è”ç¨‹åº¦çš„åº¦é‡ï¼Œæ¨¡å—é—´çš„è€¦åˆåº¦æ˜¯æŒ‡æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒåŒ…æ‹¬æ§åˆ¶å…³ç³»ã€è°ƒç”¨å…³ç³»ã€æ•°æ®ä¼ é€’å…³ç³»ï¼Œæ¨¡å—é—´è”ç³»è¶Šå¤šï¼Œè€¦åˆæ€§è¶Šå¼ºï¼Œæ¨¡å—çš„ç‹¬ç«‹æ€§è¶Šå·®ã€‚</p><h3 id="DDD-é¢†åŸŸè®¾è®¡"><a href="#DDD-é¢†åŸŸè®¾è®¡" class="headerlink" title="DDD é¢†åŸŸè®¾è®¡"></a>DDD é¢†åŸŸè®¾è®¡</h3><h2 id="å¾®æœåŠ¡æ¶æ„éœ€è¦è§£å†³çš„é—®é¢˜"><a href="#å¾®æœåŠ¡æ¶æ„éœ€è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="å¾®æœåŠ¡æ¶æ„éœ€è¦è§£å†³çš„é—®é¢˜"></a>å¾®æœåŠ¡æ¶æ„éœ€è¦è§£å†³çš„é—®é¢˜</h2><h3 id="é“¾è·¯è¿½è¸ª"><a href="#é“¾è·¯è¿½è¸ª" class="headerlink" title="é“¾è·¯è¿½è¸ª"></a>é“¾è·¯è¿½è¸ª</h3><h3 id="æœåŠ¡é—´å‘ç°"><a href="#æœåŠ¡é—´å‘ç°" class="headerlink" title="æœåŠ¡é—´å‘ç°"></a>æœåŠ¡é—´å‘ç°</h3><h3 id="æœåŠ¡é—´é€šè®¯"><a href="#æœåŠ¡é—´é€šè®¯" class="headerlink" title="æœåŠ¡é—´é€šè®¯"></a>æœåŠ¡é—´é€šè®¯</h3><h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><h3 id="ç†”æ–­å’Œé™çº§"><a href="#ç†”æ–­å’Œé™çº§" class="headerlink" title="ç†”æ–­å’Œé™çº§"></a>ç†”æ–­å’Œé™çº§</h3>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
      <category>è¿›é˜¶è®­ç»ƒè¥</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿›é˜¶è®­ç»ƒè¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®æœåŠ¡æ¦‚è§ˆ</title>
    <link href="/2024/05/11/Golang/%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%A7%88/"/>
    <url>/2024/05/11/Golang/%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%A7%88/</url>
    
    <content type="html"><![CDATA[<h1 id="å¾®æœåŠ¡-ä¸€-å¾®æœåŠ¡æ¦‚è§ˆ"><a href="#å¾®æœåŠ¡-ä¸€-å¾®æœåŠ¡æ¦‚è§ˆ" class="headerlink" title="å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ"></a>å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ</h1><h2 id="å‡ ä¸ªé—®é¢˜"><a href="#å‡ ä¸ªé—®é¢˜" class="headerlink" title="å‡ ä¸ªé—®é¢˜"></a>å‡ ä¸ªé—®é¢˜</h2><p>å…ˆé—®è‡ªå·±å‡ ä¸ªé—®é¢˜ï¼Œçœ‹æ˜¯å¦å¯ä»¥å›ç­”ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¸¦ç€é—®é¢˜æ€»ç»“è¯¾ç¨‹çš„å†…å®¹</p><ul><li>ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ</li><li>å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>å¾®æœåŠ¡å¯ä»¥å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Œåˆæœ‰é‚£äº›ç¼ºç‚¹ï¼Ÿ</li><li>å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ</li><li>å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ</li><li>å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ</li><li>å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ</li></ul><h3 id="Q1-ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ"><a href="#Q1-ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="Q1:ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ"></a>Q1:ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ</h3><ul><li>ä¹‹å‰ä¸€èˆ¬æ˜¯ä¸€ä¸ªå•ä¸€çš„å·¨çŸ³æ¶æ„ï¼Œå­˜åœ¨å¾ˆå¤šé—®é¢˜<ul><li>åº”ç”¨æ¯”è¾ƒå¤æ‚ï¼Œæ²¡æœ‰äººèƒ½å¤Ÿææ‡‚</li><li>åº”ç”¨æ‰©å±•æ¯”è¾ƒå¤æ‚ï¼Œå¯é æ€§æ¯”è¾ƒä½</li><li>æ— æ³•è¿›è¡Œæ•æ·å¼€å‘å’Œéƒ¨ç½²</li></ul></li><li>æ‰€ä»¥ä¸€èˆ¬è¿™ä¸ªæ—¶å€™å°±ä¼šè€ƒè™‘æŒ‰ç…§æœåŠ¡ã€åŠŸèƒ½è¿›è¡Œæ‹†åˆ†</li></ul><h3 id="Q2-å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Q2-å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Q2:å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Q2:å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>SOA ï¼ˆé¢å‘æœåŠ¡ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li>æœåŠ¡æ‹†åˆ†åæ¯”è¾ƒå°ï¼ŒBUG å°‘ï¼Œå®¹æ˜“æµ‹è¯•å’Œç»´æŠ¤ï¼Œä¹Ÿå®¹æ˜“æ‰©å±•</li><li>**å•ä¸€èŒè´£ï¼Œ**ä¸€ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹æƒ…</li><li>**å°½å¯èƒ½çš„æ—©çš„åˆ›å»ºåŸå‹ï¼Œ**å…ˆå®šä¹‰ APIï¼Œè¾¾æˆå¥‘çº¦</li><li>**å¯ç§»æ¤æ€§æ¯”æ•ˆç‡æ›´é‡è¦ï¼Œ**é€šè®¯åè®®çš„å¯ç§»æ¤æ€§æ›´åŠ é‡è¦</li></ul></li><li>SOA å’Œ å¾®æœåŠ¡ æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ<ul><li>å¾®æœåŠ¡æ˜¯ SOA çš„ä¸€ç§å®è·µï¼Œå¾®æœåŠ¡ä¹Ÿæ˜¯é¢å‘æœåŠ¡çš„ä¸€ç§æ¶æ„</li></ul></li><li>å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li><strong>å›´ç»•ä¸šåŠ¡åŠŸèƒ½æ„å»ºçš„ï¼ŒæœåŠ¡å…³æ³¨å•ä¸€ä¸šåŠ¡ï¼ŒæœåŠ¡é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶ï¼Œå¯ä»¥å…¨è‡ªåŠ¨ç‹¬ç«‹éƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’Œæ•°æ®å­˜å‚¨æŠ€æœ¯</strong></li></ul></li></ul><h3 id="Q3-å¾®æœåŠ¡å¯ä»¥å¸¦æ¥å“ªäº›å¥½å¤„ï¼Œåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ"><a href="#Q3-å¾®æœåŠ¡å¯ä»¥å¸¦æ¥å“ªäº›å¥½å¤„ï¼Œåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="Q3:å¾®æœåŠ¡å¯ä»¥å¸¦æ¥å“ªäº›å¥½å¤„ï¼Œåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ"></a>Q3:å¾®æœåŠ¡å¯ä»¥å¸¦æ¥å“ªäº›å¥½å¤„ï¼Œåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ</h3><ul><li><p>ä¼˜ç‚¹</p><ul><li>æœåŠ¡æ‹†åˆ†åæ¯”è¾ƒå°ï¼ŒBUG å°‘ï¼Œå®¹æ˜“æµ‹è¯•å’Œç»´æŠ¤ï¼Œä¹Ÿå®¹æ˜“æ‰©å±•</li><li>**åŸå­æœåŠ¡ï¼Œ**ä¸€ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹æƒ…ï¼Œå¹¶ä¸”è¿™ä¸ªå±äºè¿™ä¸ªæœåŠ¡çš„ä¹Ÿä¸åº”è¯¥æ‹†åˆ†åˆ°å…¶ä»–æœåŠ¡å»</li><li>**ç‹¬ç«‹è¿›ç¨‹ï¼Œ**ä¸€ä¸ªæœåŠ¡åªæœ‰ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œå¯ä»¥å¾ˆå¥½çš„å’Œå½“å‰çš„å®¹å™¨åŒ–è¿›è¡Œç»“åˆï¼Œæ— çŠ¶æ€çš„æœåŠ¡å¯ä»¥å¾ˆå®¹æ˜“çš„äº«å—åˆ°ï¼Œk8s ä¸Šçš„æ•…éšœè½¬ç§»ï¼Œè‡ªåŠ¨é‡å¯ç­‰å¥½å¤„</li><li>**éš”ç¦»éƒ¨ç½²ï¼Œ**æ¯ä¸ªæœåŠ¡ä¹‹é—´ç‹¬ç«‹éƒ¨ç½²ï¼Œå¯ä»¥é¿å…ç›¸äº’å½±å“ï¼Œå¹¶ä¸”å’ŒæŒ‰éœ€è¿›è¡Œåˆ†é…èµ„æºï¼ŒèŠ‚çœæˆæœ¬</li><li>å»ä¸­å¿ƒåŒ–æœåŠ¡æ²»ç†<ul><li>æ•°æ®å»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸ªæœåŠ¡ç‹¬äº«æ•°æ®åº“ï¼Œç¼“å­˜ç­‰è®¾æ–½ï¼Œä¹Ÿæœ‰ä¸ªåˆ«æƒ…å†µå¤šä¸ªæœåŠ¡å…±äº«æ•°æ®åº“ï¼Œä¾‹å¦‚é¢å‘ç”¨æˆ·çš„ç®¡ç†åå°å’Œé¢å‘ç®¡ç†å‘˜çš„ç®¡ç†åå°</li><li>æ²»ç†å»ä¸­å¿ƒåŒ–</li><li>æŠ€æœ¯å»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸ªæœåŠ¡å¯ä»¥ä½¿ç”¨é€‚åˆè‡ªå·±çš„æŠ€æœ¯è¿›è¡Œå®æ–½ï¼Œä½†æ˜¯æ³¨æ„å¦‚æœæŠ€æœ¯æ ˆè¿‡äºå‘æ•£å¯¹äºä¼ä¸šæˆ–è€…å›¢é˜Ÿæœ¬èº«ä¹Ÿæ˜¯ä¸åˆ©çš„</li></ul></li></ul></li><li><p>ç¼ºç‚¹</p><ul><li><p>æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å¤æ‚æˆåƒä¸Šä¸‡ä¸ªæœåŠ¡ç›¸äº’ä¾èµ–å°±åƒä¸€å›¢ä¹±éº»ä¸€æ ·ï¼Œå‰ªä¸æ–­ç†è¿˜ä¹±ã€‚</p><ul><li>å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼šå…¨é“¾è·¯è¿½è¸ªï¼Œä¾‹å¦‚ï¼Œ opentracing</li></ul></li><li><p>å¾®æœåŠ¡æœ¬èº«æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œéœ€è¦ä½¿ç”¨ RPC æˆ–è€… æ¶ˆæ¯è¿›è¡Œé€šä¿¡ï¼Œæ­¤å¤–å¿…é¡»è¦å†™ä»£ç æ¥å¤„ç†æ¶ˆæ¯ä¼ é€’ä¸­é€Ÿåº¦è¿‡æ…¢æˆ–è€…æœåŠ¡ä¸å¯ç”¨ç­‰å±€éƒ¨å¤±æ•ˆé—®é¢˜</p><ul><li>ä¾‹å­ï¼šæœåŠ¡è°ƒç”¨æµé‡ä¼šå®¹æ˜“è¢«æ”¾å¤§ï¼Œå¦‚æœ æœåŠ¡ A -&gt; B -&gt;C å¦‚æœ A æœ‰ä¸€ä¸ªå¾ªç¯è°ƒç”¨ Bï¼ŒB ä¹Ÿæœ‰ä¸€ä¸ªå¾ªç¯è°ƒç”¨ Cï¼Œé‚£ä¹ˆä¸€ä¸ªè¯·æ±‚åˆ°è¾¾ C ä¹‹åå°±è¢«æ”¾å¤§äº† 100 å€ç”šè‡³ä¸Šåƒå€ã€‚è¿™æ˜¯æ‰›ä¸ä½çš„</li><li><strong>å¸¸è§è§£å†³æ–¹æ¡ˆï¼šç²—ç²’åº¦çš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆbatch æ¥å£ï¼Œæ‰¹é‡è¯·æ±‚ï¼Œé¿å… n+1 é—®é¢˜ï¼‰ï¼Œéš”ç¦»ï¼Œè¶…æ—¶ä¿æŠ¤ï¼Œè´Ÿè½½ä¿æŠ¤ï¼Œç†”æ–­ã€é™æµã€é™çº§ã€é‡è¯•ï¼Œè´Ÿè½½å‡è¡¡</strong></li></ul></li><li><p>ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œ</p><p>å› ä¸ºç°åœ¨æ¯ä¸ªå¾®æœåŠ¡ä¹‹é—´éƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œäº‹åŠ¡åœ¨å•ä½“åº”ç”¨ä¸­å¾ˆå¥½å¤„ç†ï¼Œä½†æ˜¯åœ¨è·¨æœåŠ¡æ—¶ä¼šå˜å¾—å¾ˆéº»çƒ¦</p><ul><li>å¸¸è§è§£å†³æ–¹æ¡ˆï¼šä¸¤é˜¶æ®µæäº¤ã€TCC ç­‰</li><li><a href="https://xiaomi-info.github.io/2020/01/02/distributed-transaction/">å°ç±³ä¿¡æ¯éƒ¨æŠ€æœ¯å›¢é˜Ÿ: åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></li></ul></li><li><p>æµ‹è¯•ä¼šéå¸¸å¤æ‚ï¼Œ</p><p>ç”±äºä¾èµ–å¤šï¼Œæ— æ³•å¾—çŸ¥æ˜¯å› ä¸ºåŠŸèƒ½å¼‚å¸¸è¿˜æ˜¯ä¾èµ–çš„æŸä¸ªæœåŠ¡å‘ç‰ˆå‡ºç°é—®é¢˜</p><ul><li>å¸¸è§è§£å†³æ–¹æ¡ˆï¼šç‹¬ç«‹æµ‹è¯•ç¯å¢ƒï¼Œåé¢ä¼šæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ</li></ul></li><li><p>æœåŠ¡æ¨¡å—é—´çš„ä¾èµ–ï¼Œåº”ç”¨çš„å‡çº§æœ‰å¯èƒ½ä¼šæ³¢åŠå¤šä¸ªæœåŠ¡æ¨¡å—çš„ä¿®æ”¹ã€‚</p><ul><li>åˆ‡è®°ï¼Œåœ¨æœåŠ¡éœ€è¦å˜æ›´æ—¶æˆ‘ä»¬è¦ç‰¹åˆ«å°å¿ƒï¼ŒæœåŠ¡æä¾›è€…çš„å˜æ›´å¯èƒ½å¼•å‘æœåŠ¡æ¶ˆè´¹è€…çš„å…¼å®¹æ€§ç ´åï¼Œ<strong>æ—¶åˆ»è°¨è®°ä¿æŒæœåŠ¡å¥‘çº¦(æ¥å£)çš„å…¼å®¹æ€§</strong></li><li>å‘é€æ—¶è¦ä¿å®ˆï¼Œæ¥æ”¶æ—¶è¦å¼€æ”¾ã€‚æŒ‰ç…§ä¼¯æ–¯å¡”å°”æ³•åˆ™çš„æ€æƒ³æ¥è®¾è®¡å’Œå®ç°æœåŠ¡æ—¶ï¼Œå‘é€çš„æ•°æ®è¦æ›´ä¿å®ˆï¼Œæ„å‘³ç€æœ€å°åŒ–çš„ä¼ é€å¿…è¦çš„ä¿¡æ¯ï¼Œæ¥æ”¶æ—¶æ›´å¼€æ”¾æ„å‘³ç€è¦æœ€å¤§é™åº¦çš„å®¹å¿å†—ä½™æ•°æ®ï¼Œä¿è¯å…¼å®¹æ€§ã€‚</li></ul></li><li><p>å¯¹åŸºç¡€å»ºè®¾çš„è¦æ±‚å¾ˆé«˜ï¼Œ</p><p>åŸºç¡€è®¾æ–½éœ€è¦è‡ªåŠ¨åŒ–ï¼Œæ—¥å¿—é‡‡é›†ï¼Œç›‘æ§æ•°æ®é‡‡é›†ï¼Œå‘Šè­¦ï¼ŒCICDï¼ŒK8s ç­‰</p><ul><li>å¸¸è§è§£å†³æ–¹æ¡ˆï¼šä¸Šäº‘</li></ul></li></ul><h3 id="Q4-å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ"><a href="#Q4-å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ" class="headerlink" title="Q4: å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ"></a>Q4: <strong>å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ</strong></h3><blockquote><p>å¤šä¸ªå¾®æœåŠ¡ç»„åˆ(compose)å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·åœºæ™¯(usecase)ã€‚</p></blockquote><ul><li>kitï¼šä¸€ä¸ªå¾®æœåŠ¡çš„åŸºç¡€åº“(æ¡†æ¶)ã€‚</li><li>serviceï¼šä¸šåŠ¡ä»£ç  + kit ä¾èµ– + ç¬¬ä¸‰æ–¹ä¾èµ–ç»„æˆçš„ä¸šåŠ¡å¾®æœåŠ¡</li><li>rpc + message queueï¼šè½»é‡çº§é€šè®¯</li></ul><h3 id="Q5-å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ"><a href="#Q5-å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ" class="headerlink" title="Q5:å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ"></a>Q5:<strong>å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ</strong></h3><p><img src="https://i.imgur.com/qejM7Jh.png" alt="1718629799961"></p></li></ul><h4 id="æµé‡é“¾è·¯æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æµé‡é“¾è·¯æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æµé‡é“¾è·¯æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æµé‡é“¾è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>ç§»åŠ¨ç«¯ -&gt; API Gateway -&gt; BFF -&gt; å¾®æœåŠ¡</li><li>ä¸å« CDNã€è´Ÿè½½å‡è¡¡ï¼ˆLBï¼‰</li><li>BFF çº¯ web çš„ä¸šåŠ¡ä¸€èˆ¬ç”¨ nodejs åš SSR</li></ul><h4 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æœåŠ¡ä¸ç›´æ¥å¯¹å¤–è¿›è¡Œæš´éœ²ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æœåŠ¡ä¸ç›´æ¥å¯¹å¤–è¿›è¡Œæš´éœ²ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æœåŠ¡ä¸ç›´æ¥å¯¹å¤–è¿›è¡Œæš´éœ²ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æœåŠ¡ä¸ç›´æ¥å¯¹å¤–è¿›è¡Œæš´éœ²ï¼Ÿ</h4><ul><li>å‰ç«¯ï¼ˆç§»åŠ¨ç«¯ã€å®¢æˆ·ç«¯ã€webï¼‰åŒå­¦éå¸¸ç—›è‹¦ï¼Œéœ€è¦å¯¹æ¥å¤šä¸ªæœåŠ¡ï¼Œå…¼å®¹æ€§å·®ï¼Œæ²Ÿé€šæ•ˆç‡ä½</li><li>åç«¯åŒå­¦ä¹Ÿå¾ˆç—›è‹¦ï¼Œä¸€å¹´å‰çš„ç‰ˆæœ¬éƒ½æœ‰äººä½¿ç”¨ï¼ŒæœåŠ¡æ— æ³•è¿›è¡Œé‡æ„å‡çº§</li></ul><h4 id="ä¸ºä»€ä¹ˆéœ€è¦æœ€å¤–å±‚çš„-api-gateway"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æœ€å¤–å±‚çš„-api-gateway" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æœ€å¤–å±‚çš„ api gateway?"></a>ä¸ºä»€ä¹ˆéœ€è¦æœ€å¤–å±‚çš„ api gateway?</h4><ul><li>åŸºç¡€åº“çš„åŒå­¦éå¸¸ç—›è‹¦ï¼Œé™æµç†”æ–­å®‰å…¨ç­‰ä¸šåŠ¡æ— å…³çš„åŠŸèƒ½éœ€è¦è¿›è¡Œå‡çº§çš„æ—¶å€™å‡ä¸åŠ¨</li></ul><h3 id="Q6-å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ"><a href="#Q6-å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ" class="headerlink" title="Q6: å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ"></a>Q6: <strong>å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ</strong></h3><ul><li><p>åœ¨å¯¹ä¸šåŠ¡é¢†åŸŸä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰çš„æ—¶å€™ï¼ŒæŒ‰ç…§<strong>éƒ¨é—¨èŒèƒ½è¿›è¡Œåˆ’åˆ†ï¼Œä¾‹å¦‚è´¦å·ã€è´¢åŠ¡ç­‰</strong></p><ul><li>æ³¨æ„åˆ’åˆ†çš„æ—¶å€™<strong>è¦é—­ç¯</strong>ï¼Œä¸è¦ç›¸åŒçš„åŠŸèƒ½æ•£è½åˆ°å‡ ä¸ªéƒ¨é—¨å½“ä¸­</li></ul></li><li><p>åœ¨ç³»ç»Ÿç¨³å®šä¹‹åï¼Œç§¯ç´¯äº†ç›¸å…³çš„ä¸šåŠ¡ç»éªŒå’Œå¾®æœåŠ¡å¼€å‘ç»éªŒä¹‹åï¼Œå†è€ƒè™‘ä½¿ç”¨ DDD é™ç•Œä¸Šä¸‹æ–‡è¿›è¡Œåˆ’åˆ†</p></li><li><p>å¦‚æœå¯ä»¥é—­ç¯çš„è§£å†³ä¸€ä¸ªç”¨æˆ·åœºæ™¯ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªå¾®æœåŠ¡</p></li><li><p>è¿˜å¯ä»¥æ ¹æ®è®¿é—®é¢‘ç‡è¿›è¡ŒåŒºåˆ†åˆ’åˆ†ï¼Œå°†ç”¨æˆ·é«˜é¢‘è®¿é—®çš„éƒ¨åˆ†åˆ’åˆ†ä¸ºä¸€ä¸ªæœåŠ¡</p></li><li><p>è¿˜å¯ä»¥æ ¹æ®è¯»å†™è¿›è¡Œåˆ’åˆ†</p><ul><li><p>CQRS: å°†åº”ç”¨ç¨‹åºåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå‘½ä»¤ç«¯å’ŒæŸ¥è¯¢ç«¯ã€‚å‘½ä»¤ç«¯å¤„ç†ç¨‹åºåˆ›å»ºï¼Œæ›´æ–°å’Œåˆ é™¤è¯·æ±‚ï¼Œå¹¶åœ¨æ•°æ®æ›´æ”¹æ—¶å‘å‡ºäº‹ä»¶ã€‚æŸ¥è¯¢ç«¯é€šè¿‡é’ˆå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªç‰©åŒ–è§†å›¾æ‰§è¡ŒæŸ¥è¯¢æ¥å¤„ç†æŸ¥è¯¢ï¼Œè¿™äº›ç‰©åŒ–è§†å›¾é€šè¿‡è®¢é˜…æ•°æ®æ›´æ”¹æ—¶å‘å‡ºçš„äº‹ä»¶æµè€Œä¿æŒæœ€æ–°</p><p><img src="https://i.imgur.com/k83Ex8Q.png" alt="1718630014302"></p></li></ul></li></ul><h3 id="Q7-å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ"><a href="#Q7-å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ" class="headerlink" title="Q7:å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ"></a>Q7:<strong>å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ</strong></h3><p><img src="https://i.imgur.com/aUAJjYf.png" alt="1718630058407"></p><p>åœ¨å†…ç½‘ä¸»è¦çœ‹å®‰å…¨çº§åˆ«ä¸€èˆ¬æœ‰ä¸‰ç§ï¼š</p><ul><li>Full Trustï¼šå‡å®šå†…ç½‘æœåŠ¡ä¹‹é—´æ˜¯å®‰å…¨çš„ï¼Œåœ¨å†…ç½‘è£¸å¥”</li><li>Half Trustï¼šå†…ç½‘æœåŠ¡ä¹‹é—´éœ€è¦è¿›è¡Œè®¤è¯é‰´æƒï¼Œä½†æ˜¯ä¸éœ€è¦æ‰€æœ‰çš„éƒ½è¿›è¡ŒåŠ å¯†</li><li>Zero Trust: é›¶ä¿¡ä»»ï¼Œä»»åŠ¡å†…éƒ¨ç½‘ç»œæ˜¯ä¸å®‰å…¨çš„ï¼Œç±»ä¼¼å…¬ç½‘ï¼Œæ‰€æœ‰çš„è¯·æ±‚é€šè¿‡èº«ä»½è®¤è¯é‰´æƒä¹‹åï¼Œéƒ½éœ€è¦é€šè¿‡å®‰å…¨åŠ å¯†ï¼Œé˜²æ­¢è¢«å—…æ¢<ul><li><a href="https://www.microsoft.com/en-us/security/business/zero-trust">https://www.microsoft.com/en-us/security/business/zero-trust</a></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
      <category>è¿›é˜¶è®­ç»ƒè¥</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿›é˜¶è®­ç»ƒè¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
